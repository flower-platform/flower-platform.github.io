(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[822],{87747:(e,t,s)=>{"use strict";s.r(t),s.d(t,{assets:()=>A,contentTitle:()=>I,default:()=>F,frontMatter:()=>N,metadata:()=>D,toc:()=>O});var n=s(85893),i=s(11151),o=s(93598),r=s(67294),a=s(86010),l=s(12466),c=s(16550),d=s(20469),h=s(91980),u=s(67392),p=s(50012);function m(e){return r.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function g(e){const{values:t,children:s}=e;return(0,r.useMemo)((()=>{const e=t??function(e){return m(e).map((e=>{let{props:{value:t,label:s,attributes:n,default:i}}=e;return{value:t,label:s,attributes:n,default:i}}))}(s);return function(e){const t=(0,u.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,s])}function v(e){let{value:t,tabValues:s}=e;return s.some((e=>e.value===t))}function f(e){let{queryString:t=!1,groupId:s}=e;const n=(0,c.k6)(),i=function(e){let{queryString:t=!1,groupId:s}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!s)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return s??null}({queryString:t,groupId:s});return[(0,h._X)(i),(0,r.useCallback)((e=>{if(!i)return;const t=new URLSearchParams(n.location.search);t.set(i,e),n.replace({...n.location,search:t.toString()})}),[i,n])]}function x(e){const{defaultValue:t,queryString:s=!1,groupId:n}=e,i=g(e),[o,a]=(0,r.useState)((()=>function(e){let{defaultValue:t,tabValues:s}=e;if(0===s.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!v({value:t,tabValues:s}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${s.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const n=s.find((e=>e.default))??s[0];if(!n)throw new Error("Unexpected error: 0 tabValues");return n.value}({defaultValue:t,tabValues:i}))),[l,c]=f({queryString:s,groupId:n}),[h,u]=function(e){let{groupId:t}=e;const s=function(e){return e?`docusaurus.tab.${e}`:null}(t),[n,i]=(0,p.Nk)(s);return[n,(0,r.useCallback)((e=>{s&&i.set(e)}),[s,i])]}({groupId:n}),m=(()=>{const e=l??h;return v({value:e,tabValues:i})?e:null})();(0,d.Z)((()=>{m&&a(m)}),[m]);return{selectedValue:o,selectValue:(0,r.useCallback)((e=>{if(!v({value:e,tabValues:i}))throw new Error(`Can't select invalid tab value=${e}`);a(e),c(e),u(e)}),[c,u,i]),tabValues:i}}var j=s(72389);const b={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function w(e){let{className:t,block:s,selectedValue:i,selectValue:o,tabValues:r}=e;const c=[],{blockElementScrollPositionUntilNextRender:d}=(0,l.o5)(),h=e=>{const t=e.currentTarget,s=c.indexOf(t),n=r[s].value;n!==i&&(d(t),o(n))},u=e=>{let t=null;switch(e.key){case"Enter":h(e);break;case"ArrowRight":{const s=c.indexOf(e.currentTarget)+1;t=c[s]??c[0];break}case"ArrowLeft":{const s=c.indexOf(e.currentTarget)-1;t=c[s]??c[c.length-1];break}}t?.focus()};return(0,n.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,a.Z)("tabs",{"tabs--block":s},t),children:r.map((e=>{let{value:t,label:s,attributes:o}=e;return(0,n.jsx)("li",{role:"tab",tabIndex:i===t?0:-1,"aria-selected":i===t,ref:e=>c.push(e),onKeyDown:u,onClick:h,...o,className:(0,a.Z)("tabs__item",b.tabItem,o?.className,{"tabs__item--active":i===t}),children:s??t},t)}))})}function T(e){let{lazy:t,children:s,selectedValue:i}=e;const o=(Array.isArray(s)?s:[s]).filter(Boolean);if(t){const e=o.find((e=>e.props.value===i));return e?(0,r.cloneElement)(e,{className:"margin-top--md"}):null}return(0,n.jsx)("div",{className:"margin-top--md",children:o.map(((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==i})))})}function S(e){const t=x(e);return(0,n.jsxs)("div",{className:(0,a.Z)("tabs-container",b.tabList),children:[(0,n.jsx)(w,{...e,...t}),(0,n.jsx)(T,{...e,...t})]})}function y(e){const t=(0,j.Z)();return(0,n.jsx)(S,{...e,children:m(e.children)},String(t))}const C={tabItem:"tabItem_Ymn6"};function E(e){let{children:t,hidden:s,className:i}=e;return(0,n.jsx)("div",{role:"tabpanel",className:(0,a.Z)(C.tabItem,i),hidden:s,children:t})}const N={description:"The recommended workflow for using Tests Are Demo",sidebar_position:20},I="Tutorial",D={id:"tests-are-demo/tutorial",title:"Tutorial",description:"The recommended workflow for using Tests Are Demo",source:"@site/docs/tests-are-demo/tutorial.md",sourceDirName:"tests-are-demo",slug:"/tests-are-demo/tutorial",permalink:"/docusaurus/docs/tests-are-demo/tutorial",draft:!1,unlisted:!1,editUrl:"https://gitlab.xops-online.com/foundation/foundation-jhipster-gwt/-/blob/master/docusaurus/docs/tests-are-demo/tutorial.md",tags:[],version:"current",sidebarPosition:20,frontMatter:{description:"The recommended workflow for using Tests Are Demo",sidebar_position:20},sidebar:"tutorialSidebar",previous:{title:"Demo",permalink:"/docusaurus/docs/tests-are-demo/demo"},next:{title:'"Cheating", a reasonable compromise for hard to test cases',permalink:"/docusaurus/docs/tests-are-demo/cheat"}},A={},O=[{value:"Demo project",id:"demo-project",level:2},{value:"Create and run an empty scenario (test)",id:"create-and-run-an-empty-scenario-test",level:2},{value:"Create ...TestsAreDemo.tsx",id:"create-testsaredemotsx",level:3},{value:"Add (register) ...TestsAreDemo.tsx",id:"add-register-testsaredemotsx",level:3},{value:"Run",id:"run",level:3},{value:"Define the scenarios",id:"define-the-scenarios",level:2},{value:"Implement the first scenario",id:"implement-the-first-scenario",level:2},{value:"BDD style",id:"bdd-style",level:3},{value:"Flow: select, perform action, select, verify result",id:"flow-select-perform-action-select-verify-result",level:3},{value:"Add <code>data-testid</code> (if not existing)",id:"add-data-testid-if-not-existing",level:3},{value:"Select DOM element + perform action (copy/paste/adapt code snippet)",id:"select-dom-element--perform-action-copypasteadapt-code-snippet",level:3},{value:"Run. The &quot;demo&quot; mode works by intercepting function calls",id:"run-the-demo-mode-works-by-intercepting-function-calls",level:3},{value:"Select DOM element + verify (again, via snippet)",id:"select-dom-element--verify-again-via-snippet",level:3},{value:"Repeat until scenario is finished",id:"repeat-until-scenario-is-finished",level:3},{value:"Polish the demo for the end user",id:"polish-the-demo-for-the-end-user",level:3},{value:"Tips for implementing the remaining scenarios",id:"tips-for-implementing-the-remaining-scenarios",level:2},{value:"Linking scenarios",id:"linking-scenarios",level:3}];function k(e){const t={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",hr:"hr",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.h1,{id:"tutorial",children:"Tutorial"}),"\n",(0,n.jsx)(t.h2,{id:"demo-project",children:"Demo project"}),"\n",(0,n.jsx)(t.p,{children:"For this tutorial, we developed:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(o.lj,{children:"foundation-react/packages/tests-are-demo/src/app/todos/Todos.tsx"}),", a component that is managing things to do. Quite a classical pattern for demo apps \ud83d\ude42."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(o.lj,{children:"foundation-react/packages/tests-are-demo/src/app/todos/TodosTestsAreDemo.tsx"}),", which contains the corresponding tests, using the Tests Are Demo library."]}),"\n"]}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.code,{children:"Todos.tsx"})," looks like this:"]}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{src:s(95757).Z+"",width:"760",height:"611"})}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.code,{children:"TodosTestsAreDemo.tsx"}),' (rather the "demo" part from TestsAre',(0,n.jsx)(t.strong,{children:"Demo"}),") looks like this:"]}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{src:s(41635).Z+"",width:"804",height:"872"})}),"\n",(0,n.jsx)(t.h2,{id:"create-and-run-an-empty-scenario-test",children:"Create and run an empty scenario (test)"}),"\n",(0,n.jsx)(t.h3,{id:"create-testsaredemotsx",children:"Create ...TestsAreDemo.tsx"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-js",metastring:'title="TodosTestsAreDemo.tsx"',children:'import { render } from "@famiprog-foundation/tests-are-demo";\nimport { tad } from "@famiprog-foundation/tests-are-demo";\n\nexport class TodosTestsAreDemo {\n\n    async before() {\n        render(<Todos />);\n        await tad.waitForCommunicationFinished();\n    }\n\n    @Scenario("Hello world")\n    async helloWorld() {\n        console.log("Hello world");\n    }\n}\n'})}),"\n",(0,n.jsxs)(t.admonition,{title:"Naming convention",type:"tip",children:[(0,n.jsxs)(t.p,{children:["For file ",(0,n.jsx)(t.code,{children:"MyComponent.tsx"}),","]}),(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["containing: ",(0,n.jsx)(t.code,{children:"class MyComponent { ... }"})]}),"\n",(0,n.jsxs)(t.li,{children:["or: ",(0,n.jsx)(t.code,{children:"export const MyComponent = (...) => { ... }"})]}),"\n",(0,n.jsx)(t.li,{children:"and: maybe other secondary/internal components"}),"\n"]}),(0,n.jsxs)(t.p,{children:["=> ",(0,n.jsx)(t.code,{children:"MyComponentTestsAreDemo.tsx"}),"."]})]}),"\n",(0,n.jsx)(t.admonition,{title:"temp",type:"caution",children:(0,n.jsxs)(t.p,{children:["We currently use the ",(0,n.jsx)(t.code,{children:"render()"})," exported by Tests Are Demo. We will find a way to let people use the original ",(0,n.jsx)(t.code,{children:"render()"}),", or one customized by themselves."]})}),"\n",(0,n.jsx)(t.h3,{id:"add-register-testsaredemotsx",children:"Add (register) ...TestsAreDemo.tsx"}),"\n",(0,n.jsxs)(t.p,{children:["Let the lib know about it, in ",(0,n.jsx)(o.lj,{children:"foundation-react/packages/tests-are-demo/src/app/appTests.ts"}),". E.g.:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-js",metastring:'title="appTests.ts"',children:"tad.addTests(\n    // EmployeeDashboardTestsAreDemo,\n    // EmployeeDashboardNoDecoratorsTestsAreDemo,\n    TodosTestsAreDemo\n);\n"})}),"\n",(0,n.jsx)(t.admonition,{title:"Temp",type:"caution",children:(0,n.jsxs)(t.p,{children:["The UI doesn't allow yet selecting only one test. Comment the other tests, while working on ",(0,n.jsx)(t.code,{children:"TodosTestsAreDemo"}),". Don't forget to uncomment before commit."]})}),"\n",(0,n.jsx)(t.h3,{id:"run",children:"Run"}),"\n",(0,n.jsxs)(t.p,{children:["Go to your usual URL, e.g. ",(0,n.jsx)(t.a,{href:"http://localhost:3000?TestsAreDemo",children:"http://localhost:3000?TestsAreDemo"}),". Notice the ",(0,n.jsx)(t.code,{children:"?TestsAreDemo"}),". The ",(0,n.jsx)(t.code,{children:"Todos"})," component should render, and you should see in the console ",(0,n.jsx)(t.em,{children:"Hello world"})," printed."]}),"\n",(0,n.jsx)(t.h2,{id:"define-the-scenarios",children:"Define the scenarios"}),"\n",(0,n.jsxs)(t.p,{children:["A very good intellectual exercise is to define the scenarios that we want to implement, ",(0,n.jsx)(t.strong,{children:"before"})," doing the actual implementation. This adds structure to our thinking, and defines clearly our development road map."]}),"\n",(0,n.jsx)(t.p,{children:"At this stage, the scenarios are empty functions. A scenario == a test == a feature."}),"\n",(0,n.jsx)(t.admonition,{type:"tip",children:(0,n.jsxs)(t.p,{children:['We noticed in practice that this technique: "think about the scenarios before writing the code" has as side effect the creation of a mental structure of the code. This may also include quite soon, the identification of the sub components to use. E.g. check / uncheck a Todo => checkboxes => we need a renderer for each Todo => let\'s name it ',(0,n.jsx)(t.code,{children:"TodoItem"}),"."]})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-js",metastring:'title="TodosTestsAreDemo.tsx"',children:'export class TodosTestsAreDemo {\n    ...\n    @Comment("Todos (func comp)")\n    @Scenario("SCREEN Todos")\n    async screenTodos() {\n    }\n\n    @Scenario("WHEN click on Add, THEN the form opens")\n    async whenAddThenForm() {\n    }\n\n    ...\n    \n    // highlight-start\n    @Comment("TodoItem (func comp)")\n    @Scenario("WHEN click on checkbox or label, THEN toggle \'done\'")\n    async whenCheckbox() {\n    }\n    // highlight-end\n    \n    ...\n    \n    @Scenario("WHEN click on DELETE, THEN confirm, AND WHEN \'yes\', THEN the Todo is removed")\n    async whenDelete() {\n        // highlight-start\n        // DRAFT: click on del, verify alert open, click no, verify record still there, \n        // click again on del, click yes, verify the record is not there\n        // highlight-end\n    }\n}\n'})}),"\n",(0,n.jsxs)(t.p,{children:["Explanation (",(0,n.jsx)(t.em,{children:"click on tabs"}),"):"]}),"\n",(0,n.jsxs)(y,{children:[(0,n.jsxs)(E,{value:"scen",label:"@Scenario",default:!0,children:[(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-js",children:'export class TodosTestsAreDemo {\n    ...\n    @Comment("TodoItem (func comp)")\n    // highlight-start\n    @Scenario("WHEN click on checkbox or label, THEN toggle \'done\'")\n    async whenCheckbox() {\n    // highlight-end\n    }\n    ...\n}\n'})}),(0,n.jsxs)(t.p,{children:["Adding the ",(0,n.jsx)(t.code,{children:"@Scenario"}),' annotation, makes the function being a "runnable test". It\'s the equivalent of:']}),(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-js",children:'    it("WHEN click ...", () => { ... } )\n'})}),(0,n.jsxs)(t.p,{children:["The ",(0,n.jsx)(t.em,{children:"title"})," of the scenario (i.e. the ",(0,n.jsx)(t.code,{children:"..."})," from ",(0,n.jsx)(t.code,{children:"@Scenario(...)"}),") uses the ",(0,n.jsx)(t.a,{href:"scenarios-bdd-syntax",children:'BDD "syntax"'}),". The ",(0,n.jsx)(t.em,{children:"function name"})," is kind of abbreviation (but very short) of the scenario title."]})]}),(0,n.jsxs)(E,{value:"draft",label:"Draft content (for some scenarios)",children:[(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-js",children:"export class TodosTestsAreDemo {\n\n    ...\n\n    @Scenario(\"WHEN click on DELETE, THEN confirm, AND WHEN 'yes', THEN the Todo is removed\")\n    async whenDelete() {\n        // highlight-start\n        // DRAFT: click on del, verify alert open, click no, verify record still there, \n        // click again on del, click yes, verify the record is not there\n        // highlight-end\n    }\n\n    ...\n}\n"})}),(0,n.jsx)(t.p,{children:"For a lot of scenarios, the title (almost) fully describes the feature. But there are scenarios that contain\nsmall (and important) details. In this case, we write them down in a comment/draft, to avoid forgetting them. Once we do the\nimplementation + test, we'll delete this comment/draft, because the small (and important) details will be visible in the test."}),(0,n.jsxs)(t.p,{children:["Let's look at the example above. We have a confirmation/alert of type \"Do you really want to delete?\". It's obvious that if we click on no,\nnothing should happen, and the alert should close. So we ",(0,n.jsx)(t.strong,{children:"don't want to pollute"})," the scenario title with such a detail. But ",(0,n.jsx)(t.strong,{children:"testing"})," (and implementing)\nthe detail is important."]}),(0,n.jsx)(t.admonition,{type:"tip",children:(0,n.jsxs)(t.p,{children:["One would be amazed how often we saw regressions related to (more or less) similar things. And believe us, an user will get really mad if e.g. he/she spends say 15 minutes\nin an editor, and then hits by mistake ",(0,n.jsx)(t.code,{children:"F5"})," or ",(0,n.jsx)(t.code,{children:"Back"}),', and the dev forgot to implement a "leave page" handler + alert.']})})]}),(0,n.jsxs)(E,{value:"comment",label:"@Comment",children:[(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-js",children:'export class TodosTestsAreDemo {\n\n    ...\n    \n    // highlight-next-line\n    @Comment("Todos (func comp)")\n    @Scenario("SCREEN Todos")\n    async screenTodos() {\n    }\n\n    ...\n    \n    // highlight-next-line\n    @Comment("TodoItem (func comp)")\n    @Scenario("WHEN click on checkbox or label, THEN toggle \'done\'")\n    async whenCheckbox() {\n    }\n\n    ...\n}\n'})}),(0,n.jsxs)(t.p,{children:["Use ",(0,n.jsx)(t.code,{children:"@Comment(...)"})," for comments that you want to ",(0,n.jsx)(t.strong,{children:"see in the UI"}),". For example we used them here to kind of group the scenarios per component. Don't forget that JS supports multi line comments w/ backticks: ",(0,n.jsx)(t.code,{children:"`...`"}),"."]}),(0,n.jsxs)(t.p,{children:["One of the next pages ",(0,n.jsx)(t.strong,{children:"[TODO: add the link when we add the page]"}),' discusses the "strategic" importance of this annotation, especially during the transition (within an existing project) between the "old" mode and the "new" / Tests Are Demo mode.']})]})]}),"\n",(0,n.jsx)(t.hr,{}),"\n",(0,n.jsx)(t.h2,{id:"implement-the-first-scenario",children:"Implement the first scenario"}),"\n",(0,n.jsx)(t.h3,{id:"bdd-style",children:"BDD style"}),"\n",(0,n.jsxs)(t.p,{children:["We like ",(0,n.jsx)(t.strong,{children:"BDD"})," (behavior driven development) which is a type of TDD (test driven development) or TFD (test first development). BDD and the ",(0,n.jsx)("span",{style:{color:"red"},children:"RED"}),"/",(0,n.jsx)("span",{style:{color:"green"},children:"GREEN"})," practice (cf.  Cucumber doc) is quite good for developing server code. E.g.: we write all the tests first (skeleton + implementation), we run test #1 => it fails (it's ",(0,n.jsx)("span",{style:{color:"red"},children:"RED"}),"), we implement, we run => test passes (it's ",(0,n.jsx)("span",{style:{color:"green"},children:"GREEN"}),"). And we iterate w/ test #2, #3 and so on. When all is ",(0,n.jsx)("span",{style:{color:"green"},children:"GREEN"})," => the job is done."]}),"\n",(0,n.jsx)(t.p,{children:"However we find that:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"This approach is not reasonable for UI development."}),"\n",(0,n.jsx)(t.li,{children:"A good compromise is: the fact that we define the scenarios (only skeleton; no impl) before the code, and then for each scenario => we implement + test."}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:"Back to our tutorial: so the scenarios were defined, and now we take them one by one and we implement + test them, cf. below."}),"\n",(0,n.jsx)(t.p,{children:'We\'ll focus on the "delete" scenario. The implementation is straight forward: a "Delete" button on each line/todo. On click => an alert asking for confirmation. On confirm => the corresponding element is removed from the list.'}),"\n",(0,n.jsx)(t.h3,{id:"flow-select-perform-action-select-verify-result",children:"Flow: select, perform action, select, verify result"}),"\n",(0,n.jsx)(t.p,{children:"A test is basically a repetition of these operations:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["Step 1, ",(0,n.jsx)(t.strong,{children:"select a DOM element"}),". We use ",(0,n.jsx)(t.a,{href:"https://testing-library.com/docs/react-testing-library/intro",children:"React Testing Library"}),"."]}),"\n",(0,n.jsxs)(t.li,{children:["Step 2, ",(0,n.jsx)(t.strong,{children:"perform an action"})," (on it). We use  ",(0,n.jsx)(t.a,{href:"https://testing-library.com/docs/user-event/intro",children:"user-event"})," (related to React Testing Library)."]}),"\n",(0,n.jsxs)(t.li,{children:["Step 3, ",(0,n.jsx)(t.strong,{children:"select another DOM element"}),"."]}),"\n",(0,n.jsxs)(t.li,{children:["Step 4, ",(0,n.jsx)(t.strong,{children:"verify something"})," (on it)."]}),"\n"]}),"\n",(0,n.jsxs)(t.p,{children:["We use ",(0,n.jsx)(t.a,{href:"https://mochajs.org/",children:"Mocha"})," as the underlying framework. At the time of writing it's the only runner that has an implementation for the browser, which we need for the ",(0,n.jsx)(t.em,{children:"demo"})," part."]}),"\n",(0,n.jsxs)(t.p,{children:["For the ",(0,n.jsx)(t.em,{children:"demo"}),' part, Tests Are Demo intercepts/wraps the 3 categories of functions (select DOM element, perform action, verify). When selecting a DOM element, Tests Are Demo captures/remembers it. When performing an action or verification, Tests Are Demo will show a spotlight and a popup (focused around the captured element) and will wait for the user clicking on "Next" step.']}),"\n",(0,n.jsxs)(t.h3,{id:"add-data-testid-if-not-existing",children:["Add ",(0,n.jsx)(t.code,{children:"data-testid"})," (if not existing)"]}),"\n",(0,n.jsxs)(t.p,{children:["There are multiple ways to select a DOM element. We recommend adding ",(0,n.jsx)(t.code,{children:"data-testid"}),"s to components, and use them as selection criteria."]}),"\n",(0,n.jsxs)(t.p,{children:["React Testing Library currently recommends avoiding to (over)use the ",(0,n.jsx)(t.code,{children:"data-testid"})," attribute for selecting DOM elements. Our experience has taught us the contrary."]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-jsx",metastring:'title="Todos.tsx"',children:'export const todosTestids = createTestids("Todos", {\n    ...\n    // highlight-next-line\n    todoItem: "", todoItemCheckbox: "", todoItemCheckboxLabel: "",\n    ...\n    // TodoItem\n    // highlight-start\n    up: "", down: "", edit: "", delete: "",\n    deleteYes: "", deleteNo: "",\n    // highlight-end\n    ...\n});\n'})}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-jsx",metastring:'title="Todos.tsx"',children:'const TodoItem = ({ todo, ...props }: TodoItemProps) => {\n    ...\n    // highlight-next-line\n    return (<Segment data-testid={todosTestids.todoItem + "_" + props.index} onDoubleClick={props.onEdit} ...>\n        ...\n        <div>\n            ...\n            // highlight-next-line\n            <Button data-testid={todosTestids.delete} onClick={() => setModalOpen(true)} basic icon="delete" color="red" content="Delete" />\n}\n'})}),"\n",(0,n.jsxs)(t.p,{children:["At runtime, ",(0,n.jsx)(t.code,{children:"todosTestids.delete"})," == ",(0,n.jsx)(t.code,{children:'"Todos_delete"'}),". We use ",(0,n.jsx)(t.code,{children:"todosTestids.delete"}),", to have type checking and autocomplete. This way:"]}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["we cannot misspell (e.g. ",(0,n.jsx)(t.code,{children:"Todos_delete"})," vs ",(0,n.jsx)(t.code,{children:"Todos_delte"}),"); misspelling would be eventually discovered anyway (because the test wouldn't pass), but w/ additional cost;"]}),"\n",(0,n.jsx)(t.li,{children:"we have traceability from the implementation <-> test (via CTRL + click). This is a helpful feature \ud83d\ude09."}),"\n"]}),"\n",(0,n.jsx)(t.admonition,{title:"For uniformity",type:"caution",children:(0,n.jsxs)(t.p,{children:["Always keep ",(0,n.jsx)(t.code,{children:"data-testid"})," as the first property of a component. And BTW, did you notice that, for ",(0,n.jsx)(t.code,{children:"todosTestids"}),", we grouped (+ commented) the testids by component? And arranged the fields in sort of a space saving manner?"]})}),"\n",(0,n.jsx)(t.h3,{id:"select-dom-element--perform-action-copypasteadapt-code-snippet",children:"Select DOM element + perform action (copy/paste/adapt code snippet)"}),"\n",(0,n.jsxs)(t.p,{children:["Now that the ",(0,n.jsx)(t.code,{children:"data-testid"}),"s are there, we need to write code that uses them. Tests Are Demo UI has a handy helper feature: the ",(0,n.jsx)(t.code,{children:"Inspect testid"})," button:"]}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{src:s(91489).Z+"",width:"1382",height:"260"})}),"\n",(0,n.jsx)(t.p,{children:"And then:"}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{src:s(36388).Z+"",width:"1255",height:"219"})}),"\n",(0,n.jsx)(t.p,{children:"The snippet is in the clipboard and we paste it within the test."}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-js",metastring:'title="TodosTestsAreDemo.tsx"',children:'@Scenario("WHEN click on DELETE, THEN confirm, AND WHEN \'yes\', THEN the Todo is removed")\nasync whenDelete() {\n    let item = tad.screenCapturing.getByTestId(testids.todoItem + "_0");\n    await tad.userEventWaitable.click(tad.withinCapturing(item).getByTestId(testids.delete));\n'})}),"\n",(0,n.jsx)(t.admonition,{type:"note",children:(0,n.jsx)(t.p,{children:'In this case, we used the pasted the code snippet "as is". No modifications/adaptations were needed, which is rather rare. Normally a bit of adaptation is needed to the pasted snippet. So please consider this copy/paste workflow as an aid, not a bullet proof mechanism!'})}),"\n",(0,n.jsxs)(t.admonition,{type:"info",children:[(0,n.jsxs)(t.p,{children:["1/ in ",(0,n.jsx)(t.code,{children:"Todos.tsx"})," we have ",(0,n.jsx)(t.code,{children:"todosTestids"}),". 2/ here, in ",(0,n.jsx)(t.code,{children:"TodosTestsAreDemo.tsx"})," we have ",(0,n.jsx)(t.code,{children:"testids"}),". Hence we rename the import:"]}),(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-js",metastring:'title="TestsAreDemo.tsx"',children:'import { ..., todosTestids as testids } from "./Todos";\n'})}),(0,n.jsx)(t.p,{children:'1/ is so, so that we don\'t pollute the content assist (e.g. type "testids" => tons of proposals). 2/ is so, for easier snippet genaration.'})]}),"\n",(0,n.jsx)(t.h3,{id:"run-the-demo-mode-works-by-intercepting-function-calls",children:'Run. The "demo" mode works by intercepting function calls'}),"\n",(0,n.jsxs)(t.p,{children:["After running the test (w/ the option ",(0,n.jsx)(t.strong,{children:'"Step by step" = ON'})," [default]), we have this result:"]}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{src:s(60920).Z+"",width:"801",height:"210"})}),"\n",(0,n.jsx)(t.p,{children:'Let\'s explain what is happening. We compare Tests Are Demo code with "plain" React Testing Library code. For the selection of the DOM element:'}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-js",children:'// 1/ Tests Are Demo code\nlet item = tad.screenCapturing.getByTestId(testids.todoItem + "_0");\n// 2/ normal React Testing Library code\nlet item = screen.getByTestId(testids.todoItem + "_0");\n'})}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.code,{children:"tad.screenCapturing().getByTestId()"})," (from 1/) is a wrapper around ",(0,n.jsx)(t.code,{children:"screen.getByTestId()"}),' (from 2/). 1/ calls 2/. All the wrapped functions behave identically, except that they capture and remember the DOM element that was selected. Hence the suffix "Capturing". We grouped all TAD functions into ',(0,n.jsx)(t.code,{children:"tad"}),', to make our lib "content assist" friendly. I.e. type ',(0,n.jsx)(t.code,{children:"tad."})," and see what are the available functions, w/o needing to go to the doc."]}),"\n",(0,n.jsxs)(t.p,{children:["To perform an action, ",(0,n.jsx)(t.code,{children:"tad.userEventWaitable()"})," (from 3/) is also a wrapper:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-js",children:"// 3/ Tests Are Demo code\nawait tad.userEventWaitable.click(tad.withinCapturing(item).getByTestId(testids.delete));\n// 4/ normal React Testing Library code\nuserEvent.click(within(item).getByTestId(testids.delete));\n"})}),"\n",(0,n.jsxs)(t.p,{children:["3/ captures the action that will be performed (the function name, e.g. ",(0,n.jsx)(t.code,{children:"click"}),'), it displays a "spotlight" around the last captured element (e.g. the "Delete" button), it shows a popup saying "Will perform click", and then waits. When the user does something, e.g. click on "Next", then 4/ is called, and the test continues. Hence the suffix "Waitable" and the function being async. We chose this suffix so that people can remember that they also need to use ',(0,n.jsx)(t.code,{children:"await"}),"."]}),"\n",(0,n.jsx)(t.h3,{id:"select-dom-element--verify-again-via-snippet",children:"Select DOM element + verify (again, via snippet)"}),"\n",(0,n.jsx)(t.p,{children:"We apply the same process to obtain a snippet for verification:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-js",metastring:'title="TodosTestsAreDemo.tsx"',children:'@Scenario("WHEN click on DELETE, THEN confirm, AND WHEN \'yes\', THEN the Todo is removed")\nasync whenDelete() {\n    let item = tad.screenCapturing.getByTestId(testids.todoItem + "_0");\n    await tad.userEventWaitable.click(tad.withinCapturing(item).getByTestId(testids.delete));\n\n    // highlight-start\n    await tad.userEventWaitable.click(tad.screenCapturing.getByTestId(testids.deleteNo));\n    tad.cc("The Todo wasn\'t deleted");\n    await tad.assertWaitable.equal(tad.withinCapturing(item).getByTestId(testids.todoItemCheckboxLabel).textContent, someTodos[0].text);\n    // highlight-end\n'})}),"\n",(0,n.jsx)(t.p,{children:"We have the result:"}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{src:s(13810).Z+"",width:"441",height:"275"})}),"\n",(0,n.jsxs)(t.p,{children:['We added a new "perform action" line, simulating clicking on "No" (in the alert that\'s opened after clicking on "Delete"). And then a ',(0,n.jsx)(t.strong,{children:'"verification"'})," line. Here we have the same interception mechanism, but applied this time to ",(0,n.jsx)(t.code,{children:"assert"})," from ",(0,n.jsx)(t.a,{href:"https://www.chaijs.com/",children:"Chai Assertion Library"}),"."]}),"\n",(0,n.jsxs)(t.p,{children:["If the first lines were quite readable, this particular verification line is not straight forward. Meaning that just by reading it, it's not clear what we want to achieve actually. Hence the need for a ",(0,n.jsx)(t.strong,{children:"comment"}),", i.e. ",(0,n.jsx)(t.code,{children:"tad.cc()"})," which is an alias for ",(0,n.jsx)(t.code,{children:"tad.currentComment()"}),". We use comments this way (instead of ",(0,n.jsx)(t.code,{children:"// this way"}),"), so that they can be displayed in the UI."]}),"\n",(0,n.jsx)(t.h3,{id:"repeat-until-scenario-is-finished",children:"Repeat until scenario is finished"}),"\n",(0,n.jsx)(t.p,{children:"To finish the test/scenario, we repeat the steps above. Let's recap them:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["add ",(0,n.jsx)(t.code,{children:"data-testid"})," (if needed),"]}),"\n",(0,n.jsxs)(t.li,{children:["copy/paste/adapt code for ",(0,n.jsx)(t.strong,{children:"performing actions"}),","]}),"\n",(0,n.jsxs)(t.li,{children:["copy/paste/adapt code for ",(0,n.jsx)(t.strong,{children:"verification"}),"."]}),"\n"]}),"\n",(0,n.jsx)(t.admonition,{type:"tip",children:(0,n.jsxs)(t.p,{children:['We recommend keeping "Auto run after page load" = true (default). Probably you are running Tests Are Demo inside a toolchain (such as ',(0,n.jsx)(t.a,{href:"https://vitejs.dev/",children:"Vite"})," or ",(0,n.jsx)(t.a,{href:"https://create-react-app.dev/",children:"Create React App"}),") that has auto-refresh or hot module reload (HMR) enabled. Hence when you save, the browser will refresh and the test will run again. This is convenient."]})}),"\n",(0,n.jsx)(t.h3,{id:"polish-the-demo-for-the-end-user",children:"Polish the demo for the end user"}),"\n",(0,n.jsx)(t.p,{children:'The "slide show"/visual test steps are practically a demo of our component or app. They are meaningful for a dev that looks at the demo. And they are also (almost) meaningful for an end user. However, when presenting the demo to and user, a bit of additional polishing may be needed.'}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-js",metastring:'title="TodosTest.tsx"',children:'@Scenario("WHEN click on DELETE, THEN confirm, AND WHEN \'yes\', THEN the Todo is removed")\nasync whenDelete() {\n    // highlight-next-line\n    tad.cc("A Todo may be deleted");\n\n    // highlight-next-line\n    tad.demoForEndUserHide();\n    let item = tad.screenCapturing.getByTestId(testids.todoItem + "_0");\n    await tad.userEventWaitable.click(tad.withinCapturing(item).getByTestId(testids.delete));\n\n    await tad.userEventWaitable.click(tad.screenCapturing.getByTestId(testids.deleteNo));\n    tad.cc("The Todo wasn\'t deleted");\n    await tad.assertWaitable.equal(tad.withinCapturing(item).getByTestId(testids.todoItemCheckboxLabel).textContent, someTodos[0].text);\n    // highlight-next-line\n    tad.demoForEndUserShow();\n\n    await tad.userEventWaitable.click(tad.withinCapturing(item).getByTestId(testids.delete));\n    await tad.userEventWaitable.click(tad.screenCapturing.getByTestId(testids.deleteYes));\n    // highlight-next-line\n    tad.cc("The Todo was deleted. So the second element (index 1) became element the first element (index 0)");\n    item = tad.screenCapturing.getByTestId(testids.todoItem + "_0");\n    await tad.assertWaitable.include(tad.withinCapturing(item).getByTestId(testids.todoItemCheckboxLabel).textContent, someTodos[1].text); // include instead of equals, because we appended something in a step above\n}\n'})}),"\n",(0,n.jsx)(t.p,{children:"Some ways to polish:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"by adding additional comments. Such as providing some context or intro at the beginning of the scenario, or adding text to mark the transition from the previous scenario."}),"\n",(0,n.jsx)(t.li,{children:'by hiding steps which would bore the end user. E.g. here we don\'t want to show that we test clicking on the "No" button of the "Do you want to delete?" dialog.'}),"\n",(0,n.jsx)(t.li,{children:'by rephrasing a comment using a language suitable for the end user. E.g. here we used both "first element" (in "user language") and "index 0" (in dev language).'}),"\n"]}),"\n",(0,n.jsx)(t.h2,{id:"tips-for-implementing-the-remaining-scenarios",children:"Tips for implementing the remaining scenarios"}),"\n",(0,n.jsxs)(t.admonition,{title:"temp",type:"caution",children:[(0,n.jsx)(t.p,{children:'We already explained that the UI doesn\'t allow selecting a "current" file. Hence during dev, we need to comment the other files.'}),(0,n.jsxs)(t.p,{children:["Regarding individual scenarios (tests), we have the ",(0,n.jsx)(t.code,{children:"@Only"})," annotation. If we annotate a certain function with it, in principle, only that scenario will run. This is inspired from Mocha's ",(0,n.jsx)(t.code,{children:"it.only(...)"}),"."]})]}),"\n",(0,n.jsx)(t.h3,{id:"linking-scenarios",children:"Linking scenarios"}),"\n",(0,n.jsx)(t.p,{children:"Let's look at this:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-js",metastring:'title="TodosTestsAreDemo.tsx"',children:'@Scenario("WHEN click on Add, THEN the form opens")\n@ScenarioOptions({ linkWithNextScenario: true })\nasync whenAddThenForm() {\n    tad.cc("Let\'s add a new Todo");\n    await tad.userEventWaitable.click(tad.screenCapturing.getByTestId(testids.add));\n}\n\n@Scenario("FORM for a Todo; test #1")\nasync formTodo1() {\n    tad.cc("Please observe that this text field is already focused. So you can directly start typing, w/o needing to click here first");\n    const textbox = tad.withinCapturing(tad.screenCapturing.getByTestId(testids.inputText)).getByRole(\'textbox\');\n    ...\n'})}),"\n",(0,n.jsx)(t.p,{children:"Linking scenarios helps us write less code:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"whenAddThenForm()"})," doesn't have a verification part. The verification is practically done in the next scenario. If the form wouldn't open, the next scenario would fail while finding ",(0,n.jsx)(t.code,{children:"testids.inputText"}),"."]}),"\n",(0,n.jsxs)(t.li,{children:[(0,n.jsx)(t.code,{children:"formTodo1()"})," doesn't have a part that opens the form. Because this is done by the previous scenario."]}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:'The two scenarios are linked/dependent, and they "help" each other. And we wrote less code, compared to the case where the two scenarios are independent. Less code to achieve the same result is always good, but in particular in the "test business", where test clutter is a constant threat.'}),"\n",(0,n.jsxs)(t.p,{children:["When one scenario is ran individually (e.g. via ",(0,n.jsx)(t.code,{children:"@Only"})," or via UI), then the other is ran as well. Chaining more than 2 scenarios is also possible."]})]})}function F(e={}){const{wrapper:t}={...(0,i.a)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(k,{...e})}):k(e)}},93598:(e,t,s)=>{"use strict";s.d(t,{sS:()=>h,Tm:()=>u,Fb:()=>p,lj:()=>c,h8:()=>d});s(67294);class n{static now(){return new Date}static consoleLogJson(e,t){void 0===t&&(t=!0);const s=JSON.stringify(e,(()=>{const e=new WeakSet;return(t,s)=>{if(!t.startsWith("__react")){if("object"==typeof s&&null!==s){if(e.has(s))return;e.add(s)}return s}}})(),2);return t&&console.log(s),s}static substringAfter(e,t,s){const n=s?e.lastIndexOf(t):e.indexOf(t);return n<0?e:e.substring(n+t.length)}static setTimeoutPromise(e,t){return new Promise((s=>setTimeout((()=>{const t=e?.();s(t)}),t)))}}var i=s(9286),o=s(30877),r=s(37839),a=s(91262),l=s(85893);const c=e=>{return(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)("a",{target:"_blank",href:(t=e.children,"https://gitlab.xops-online.com/foundation/foundation-jhipster-gwt/-/tree/master/"+t+(e.lineNumbers?.[0]?`#L${e.lineNumbers[0]}`:"")+(e.lineNumbers?.[1]?`-L${e.lineNumbers[1]}`:"")),children:[n.substringAfter(e.children,"/",!0),e.region&&(0,l.jsxs)("small",{children:["\xa0",(0,l.jsxs)("i",{children:["(region ",e.region,", between lines [",e.lineNumbers[0],", ",e.lineNumbers[1],"])"]})]})]})});var t},d=e=>(0,l.jsx)(o.Z,{circular:!0,color:"blue",children:e.s}),h=e=>{let{src:{text:t,path:s},region:n,...o}=e;const r=new RegExp(`#region\\s*${n}\\r?\\n(.*?)#endregion`,"s").exec(t);if(!r)throw new Error(`In file = ${s}, cannot find region = ${n}, i.e. a portion like:\n\n#region ${n}\n...\n#endregion`);let a,d=r[1],h=1,u=-1;for(a=0;a<r.index+r[0].length;a++)"\n"===t[a]&&h++,-1===u&&a>=r.index&&(u=h);u++,h--,d="\n"+d;const p=d.match(/\n(\s)*\S/);let m;if(p&&(m=p[1])){const e=new RegExp(`\\n(${m}*)\\S`,"g");let t,s=-1;for(;null!==(t=e.exec(d));)(s<0||s>t[1].length)&&(s=t[1].length);const n=m.repeat(s);d=d.replace(new RegExp("\\n"+n,"g"),"\n")}return d=d.substring(1),(0,l.jsx)(l.Fragment,{children:(0,l.jsx)(i.Z,{title:(0,l.jsxs)(l.Fragment,{children:["Snippet extracted from ",(0,l.jsx)(c,{region:n,lineNumbers:[u,h],children:s})]}),...o,children:d})})},u=e=>(0,l.jsx)(h,{language:"java",...e}),p=e=>(0,l.jsx)(a.Z,{children:()=>(0,l.jsx)(r.J6,{recordedTestsUrl:"https://gitlab.xops-online.com/foundation/foundation-jhipster-gwt/-/raw/master/leave-management/leave-management-react/public/recordedTests/recordedTest.json",includeCredentialsInJsonRequestRegex:/https:\/\/gitlab\.xops-online\.com\/*/,...e})})},37839:(e,t,s)=>{"use strict";s.d(t,{J6:()=>Zt});var n=s(85893),i=s(67294),o=s(34273),r=s(98066),a=s(99678),l=s(18229),c=s(88970),d=s(91530),h=s(57467),u=s(51082),p=s(187),m=s(82528),g=s(42336),v=s(88081),f=s(57182);function x(e){let t=("horizontal"===e.split?"flex-container-row":"flex-container")+" flex-grow";e.className&&(t+=" "+e.className);const s=(0,n.jsx)(f.Z,Object.assign({},e,{className:t,style:Object.assign(Object.assign({position:"static"},e.style),{flex:"1 1 0"})},{children:e.children}),void 0);return"horizontal"===e.split?(0,n.jsx)("div",Object.assign({className:"flex-grow"},{children:s}),void 0):s}class j{static isTest(){return"undefined"!=typeof process&&void 0!==process.release&&"node"===process.release.name}static now(){return new Date}static consoleLogJson(e,t){void 0===t&&(t=!0);const s=JSON.stringify(e,(()=>{const e=new WeakSet;return(t,s)=>{if(!t.startsWith("__react")){if("object"==typeof s&&null!==s){if(e.has(s))return;e.add(s)}return s}}})(),2);return t&&console.log(s),s}static substringAfter(e,t,s){const n=s?e.lastIndexOf(t):e.indexOf(t);return n<0?e:e.substring(n+t.length)}static substringBefore(e,t,s){const n=s?e.lastIndexOf(t):e.indexOf(t);return n<0?e:e.substring(0,n)}static getRGBValuesColor(e){var t=[];let s=16711680&e;s>>=16;let n=65280&e;n>>=8;let i=255&e;return t[0]=s,t[1]=n,t[2]=i,t}static getRGBAColor(e,t){var s=j.getRGBValuesColor(e);return"rgba("+s[0]+","+s[1]+","+s[2]+","+t+")"}static convertColorToHex(e){let t=e.toString(16),s=6-t.length;if(0===s)return"#"+t;{let e="";for(let t=0;t<s;t++)e+="0";return"#"+e+t}}static convertColorFromHex(e){if(!(e=e.trim()).startsWith("#"))throw new Error("Color should start with '#'");return e=e.substring(1),parseInt(e,16)}static convertToGrayscale(e){return.299*j.getRGBValuesColor(e)[0]+.587*j.getRGBValuesColor(e)[1]+.114*j.getRGBValuesColor(e)[2]}static getContrastingForegroundColor(e){return j.convertToGrayscale(e)<128?16777215:this.convertColorFromHex(j.DEFAULT_TEXT_COLOR)}static setTimeoutPromise(e,t){return new Promise((s=>setTimeout((()=>{const t=null==e?void 0:e();s(t)}),t)))}}j.DEFAULT_TEXT_COLOR="#000000";var b=s(83059),w=s(80109),T=s(37195),S=s(17658),y=s(8518),C=s(28614),E=function(e,t){var s={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(s[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(s[n[i]]=e[n[i]])}return s};const N=e=>{let{children:t,enrich:s,baseUrlForImages:i}=e;return t?(0,n.jsx)(b.D,{className:"FeatureBookServer_Markdown",children:t,remarkPlugins:[w.Z],rehypePlugins:[T.Z,S.Z,[y.Z,{content:{type:"element",children:[],tagName:"i",properties:{className:["icon","linkify","small"]}}}]],components:{code(e){var{node:t,inline:s,className:i,children:o}=e,r=E(e,["node","inline","className","children"]);const a=/language-(\w+)/.exec(i||"");return!s&&a?(0,n.jsx)(C.Z,Object.assign({},r,{children:String(o).replace(/\n$/,""),language:a[1],PreTag:"div"}),void 0):(0,n.jsx)("code",Object.assign({},r,{className:i},{children:o}),void 0)}},transformImageUri:e=>i?i+"/"+e:e},void 0):null};var I=s(22408),D=s(4196),A=s.n(D),O=s(54422),k=function(e,t,s,n){return new(s||(s=Promise))((function(i,o){function r(e){try{l(n.next(e))}catch(t){o(t)}}function a(e){try{l(n.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,a)}l((n=n.apply(e,t||[])).next())}))},F=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,s=e[Symbol.asyncIterator];return s?s.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(s){t[s]=e[s]&&function(t){return new Promise((function(n,i){(function(e,t,s,n){Promise.resolve(n).then((function(t){e({value:t,done:s})}),t)})(n,i,(t=e[s](t)).done,t.value)}))}}};class P{constructor(){this.cache={}}getSourceCodeState(e,t,s){return k(this,void 0,void 0,(function*(){const n=this.getMapFileUrl(e);if(!this.cache[e])try{const t=yield fetch(n);if(!t.ok)throw new Error("Server returned code "+t.status+" - "+t.statusText);const s=yield t.text(),i=new I.TraceMap(JSON.parse(s));this.cache[e]=i}catch(r){return void console.error("Error while processing source-map: fetch",n,r)}const i=(0,I.originalPositionFor)(this.cache[e],{line:t,column:s});if(!i.source||!i.line)return void console.error("Error while processing source-map: originalPositionFor()",n);const o=(0,I.sourceContentFor)(this.cache[e],i.source);if(o)return{sourceCode:o,sourceFile:i.source,sourceLine:i.line,sourceColumn:i.column};console.error("Error while processing source-map: sourceContentFor()",n)}))}decodeStackTrace(e){var t,s,n;return k(this,void 0,void 0,(function*(){let i;if(!e.stack||(i=e.stack.indexOf("\n"))<0)return e.message+" - No stacktrace available";const o=(0,O.Q)(e).map((e=>e.getFunctionName()));let r=null===(n=e.stack)||void 0===n?void 0:n.substring(0,i);const a=A().parse(e);try{for(var l,c=F(a.entries());!(l=yield c.next()).done;){const[e,t]=l.value;if(!t.fileName||!t.lineNumber||!t.columnNumber)continue;const s=yield this.getSourceCodeState(t.fileName,t.lineNumber,t.columnNumber);if(!s)continue;const n=window.location.origin+s.sourceFile.split("..").pop()+":"+s.sourceLine+":"+(s.sourceColumn+1);r+="\n\t "+(o[e]?" at "+o[e]:"")+" ["+s.sourceCode.split("\n")[s.sourceLine-1].trim()+"] ("+n+")"}}catch(d){t={error:d}}finally{try{l&&!l.done&&(s=c.return)&&(yield s.call(c))}finally{if(t)throw t.error}}return r}))}getMapFileUrl(e){let t=e;return e.startsWith("http")||(t=window.location.origin+"/"+e),t.split("?")[0]+".map"}}P.INSTANCE=new P;var R=s(41907),M=s(64077),Z=s(7393),_=s.n(Z);class U{constructor(){this.classToName=new Map,this.count=0}getClassName(e){let t=this.classToName.get(e);return t||(t=e.name+"_"+this.count++,this.classToName.set(e,t)),t}getClassNameFromObject(e){return e.constructor.name||(e=Object.getPrototypeOf(Object.getPrototypeOf(e))),this.getClassName(e.constructor)}}U.INSTANCE=new U;const L="$extensions for class$";let B,W;function $(e,t){B=e,W=t}function H(e){if(e||(e=B),!e)throw new Error("Error while calling 'pseudo' annotation. Not called via native decorators, and the global for 'pseudo' decorators is undefined.");let t=e.extensions;return t||(e.extensions=t={}),t}var z=s(58653),V=function(e,t,s,n){return new(s||(s=Promise))((function(i,o){function r(e){try{l(n.next(e))}catch(t){o(t)}}function a(e){try{l(n.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,a)}l((n=n.apply(e,t||[])).next())}))};function q(e){const{left:t,top:s,width:n,height:i}=e.getBoundingClientRect();return{x:t+n/2,y:s+i/2}}const J=e=>function(e){if("object"!=typeof e)return!1;let t,s;do{if(s=Object.getPrototypeOf(e),t=Object.prototype.toString.call(s),"[object Element]"===t||"[object Document]"===t)return!0;e=s}while(null!==s);return!1}(e)?q(e):e,G=e=>new Promise((t=>{setTimeout(t,e)}));function K(e,t){let{from:s,to:n,delta:i,steps:o=20,duration:r=500,options:a={}}=t;return V(this,void 0,void 0,(function*(){const t=s||q(e),l=i?{x:t.x+i.x,y:t.y+i.y}:J(n),c=(l.x-t.x)/o,d=(l.y-t.y)/o,h=Object.assign({clientX:t.x,clientY:t.y},a);z.fireEvent.mouseEnter(e,h),z.fireEvent.mouseOver(e,h),z.fireEvent.mouseMove(e,h),z.fireEvent.mouseDown(e,h);for(let s=0;s<o;s++)h.clientX+=c,h.clientY+=d,yield G(r/o),z.fireEvent.mouseMove(e,h);z.fireEvent.mouseUp(e,h)}))}var Y=s(95924),X=s.n(Y),Q=s(92761),ee=function(e,t,s,n){return new(s||(s=Promise))((function(i,o){function r(e){try{l(n.next(e))}catch(t){o(t)}}function a(e){try{l(n.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,a)}l((n=n.apply(e,t||[])).next())}))};class te{constructor(e){this.master=e,this.files={},this.lastInvocationIndex=0,this.visibleLinesForFirstAndLastChunk=10,this.lastScreenshotNumber=0,this.testIdChainToCountForFileName={},this.recodedTest={slides:[],sourceFiles:{},duration:-1},this.creationTime=(new Date).getTime()}calculateLastScreenshotName(e){let t=(null==e?void 0:e.getAttribute(this.master.testIdProp))?"":"_LAP",s=e;for(;s;){const e=s.getAttribute(this.master.testIdProp);e&&(t=t?e+"_"+t:e),s=s.parentElement}void 0!==this.testIdChainToCountForFileName[t]?(this.testIdChainToCountForFileName[t]++,t+="_REP"+this.testIdChainToCountForFileName[t]):this.testIdChainToCountForFileName[t]=0,this.lastScreenshotNumber++,this.lastScreenshotName=t}onShowSpotlight(e,t){if(this.calculateLastScreenshotName(t),this.messageSentToPuppeteer){const e=`Illegal state: paused/waiting because of \`showSpotlight()\`, but \`showSpotlight()\` called again. Maybe there is somewhere an invocation to a function like \`tad.awaitable...\` w/o prefixing w/ \`await\`?\nOld screenshot = ${JSON.stringify(this.messageSentToPuppeteer,void 0," ")}, new screenshot = ${JSON.stringify(this.createMessageForPuppeteer(),void 0," ")}`;throw new Error(e)}e?this.lastSourceCodeState=e:(this.lastSourceCodeState||(this.lastSourceCodeState={sourceFile:"Source file not available",sourceCode:"",sourceLine:1,sourceColumn:1}),e=this.lastSourceCodeState);const{sourceFile:s,sourceCode:n,sourceLine:i}=e;let o=this.files[s];o||(o={sourceCode:n,screenshots:{}},this.files[s]=o);let r=o.screenshots[i];r||(r=[],o.screenshots[i]=r),r.push({invocationIndex:++this.lastInvocationIndex,file:this.lastScreenshotName}),this.recodedTest.sourceFiles[s]||(this.recodedTest.sourceFiles[s]=n),this.recodedTest.slides.push({screenshot:this.lastScreenshotName,sourceFile:s,sourceLine:i}),this.sendScreenshotToPuppeteer()}sendScreenshotToPuppeteer(){return ee(this,void 0,void 0,(function*(){if(this.messageSentToPuppeteer=this.createMessageForPuppeteer(),this.master.slave.lastElementCaptured){const e=this.master.slave.lastElementCaptured.getBoundingClientRect();this.messageSentToPuppeteer.rect={x:e.x,y:e.y,width:e.width,height:e.height}}this.master.sendMessageToPuppeteer("waitingForNextStep",this.messageSentToPuppeteer)}))}createMessageForPuppeteer(){return{dir:this.master.slave.reporterFromSlaveToMaster.currentClass+"/"+this.master.slave.reporterFromSlaveToMaster.currentFunction,screenshotNumber:this.lastScreenshotNumber,fileWithoutExtension:this.lastScreenshotName}}onScreenshotSavedByPuppeteer(e){var t;if(this.messageSentToPuppeteer.dir!==e.dir||this.messageSentToPuppeteer.fileWithoutExtension!==e.fileWithoutExtension||this.messageSentToPuppeteer.screenshotNumber!==e.screenshotNumber)throw new Error(`Something went wrong. Puppeteer and the app are not in sync any more. Screenshot sent by the app to be saved = ${JSON.stringify(this.messageSentToPuppeteer,void 0," ")}. But puppeteer says it just saved = ${JSON.stringify(e,void 0," ")}`);this.master.slave.reporterFromSlaveToMaster.testFailed?(null===(t=this.resumeSendingReportToPuppeteerCallback)||void 0===t||t.call(this),this.messageSentToPuppeteer=void 0):this.master.nextStep()}waitForError(){if(this.waitForErrorPromise)throw new Error("Illegal! waitForError() was called, errorArrived() was NOT called, and then waitForError() was called again");this.waitForErrorPromise=new Promise((e=>this.waitForErrorPromiseResolve=e))}errorArrived(e){var t;this.recodedTest.error=e,null===(t=this.waitForErrorPromiseResolve)||void 0===t||t.call(this,e)}getError(){return ee(this,void 0,void 0,(function*(){return this.error||this.waitForErrorPromise||void 0}))}processComment(e){let t=e;return t=t.replace(/^\s*/,""),t=t.replace(/\s*$/,""),t.split(/\n/)}printMarkdown(e){var t,s;return ee(this,void 0,void 0,(function*(){const n=j.substringBefore(e,".",!0),i=j.substringAfter(e,".",!0),o=null===(t=this.master.state.testClassDescriptors)||void 0===t?void 0:t.find((e=>e.name===n)),r=null==o?void 0:o.functions.find((e=>e.functionName===i));let a=`\n# ${e}()\n\n### ${null==r?void 0:r.scenario}\n`;(null==r?void 0:r.comments)&&(a+="\n```\n",null===(s=null==r?void 0:r.comments)||void 0===s||s.forEach((e=>{this.processComment(e).forEach((e=>{a+=`// ${e.trim()}\n`}))})),a+="```\n"),a+="\n---\n";const l=yield this.getError();void 0!==l&&(a+=`\n## The following error was caught while running the test:\n\n\`\`\`\n${l}\n\`\`\`\n\n---\n\n`),a+=`\nThere are ${this.lastInvocationIndex} screenshots. [Go to first](#screenshot-1)\n`;for(let t in this.files){const s=this.files[t];a+=`\n## ${t}\n`;const n=Object.getOwnPropertyNames(s.screenshots).map((e=>parseInt(e)));n.sort(((e,t)=>e-t));const i=s.sourceCode.split("\n"),o=i.length.toString().length;i.forEach(((e,t)=>i[t]="/*"+(t+1).toString().padStart(o)+"*/"+e));let r=0;const l=n.length>0&&n[0];!1!==l&&l>this.visibleLinesForFirstAndLastChunk&&(r=l-this.visibleLinesForFirstAndLastChunk,a+=this.printChunk(e,i,0,r));for(let t of n)a+=this.printChunk(e,i,r,t,s.screenshots[t]),r=t;a+=this.printChunk(e,i,r,void 0)}return a}))}printChunk(e,t,s,n,i){let o=`${i?"":"\n<details><summary>Click to expand the hidden lines of code</summary>\n"}\n\`\`\`tsx\n${t.slice(s,n).join("\n")}\n\`\`\`\n${i?"":"\n</details>\n"}`;if(!i)return o;for(let r of i)o+=`\n<table><tr>\n<td>\n\n### Screenshot ${r.invocationIndex}\n\n${r.invocationIndex<=1?"":`[Go to previous](#screenshot-${r.invocationIndex-1})`}${r.invocationIndex<=1||r.invocationIndex>=this.lastInvocationIndex?"":" | "}${r.invocationIndex>=this.lastInvocationIndex?"":` [Go to next](#screenshot-${r.invocationIndex+1})`}\n\n<details><summary>Click to expand full image</summary>\n\n${e}/${r.file}.png <br/>\n![](${r.file}.png)\n\n</details>\n</td>\n<td>\n\n![](${r.file}_small.png)\n\n</td>\n</tr></table>\n`;return o}sendMarkdownToPuppeteer(){return ee(this,void 0,void 0,(function*(){let e;this.recodedTest.duration=(new Date).getTime()-this.creationTime;const t=()=>ee(this,void 0,void 0,(function*(){const t=this.master.slave.reporterFromSlaveToMaster.currentClass+"/"+this.master.slave.reporterFromSlaveToMaster.currentFunction;this.master.sendMessageToPuppeteer("writeMarkdownReport",{dir:t,markdown:yield this.printMarkdown(t),recordedTest:this.recodedTest}),this.resumeSendingReportToPuppeteerCallback=void 0,null==e||e.apply(null)}));if(this.messageSentToPuppeteer){if(this.master.slave.reporterFromSlaveToMaster.testFailed)return console.log("We want to print the Markdown report. But the call from puppeteer didn't return. So we'll wait, and then we'll continue w/ writing the report"),this.resumeSendingReportToPuppeteerCallback=t,new Promise((t=>e=t));throw new Error("There is no test failure (because of async code), a screenshot save is in progress, so why are we trying to send the report?")}yield t()}))}}var se=function(e,t,s,n){return new(s||(s=Promise))((function(i,o){function r(e){try{l(n.next(e))}catch(t){o(t)}}function a(e){try{l(n.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,a)}l((n=n.apply(e,t||[])).next())}))};class ne{constructor(e,t,s,n){this.componentName=e,this.id=t,this.functionName=s,this.args=n}getTestId(){return this.componentName+"_"+this.id+"_"+this.functionName}getGeneratedSourceCode(){var e;const t=null===(e=this.args)||void 0===e?void 0:e.map((e=>"string"==typeof e?'"'+e+'"':e)).join(",");return`await uiApi${this.componentName}(${this.id?this.id:""}).dispatcher.${this.functionName}(${t});`}}class ie extends i.Component{static getKey(e,t){return e+"_"+t}componentDidMount(){ie.listeners[ie.getKey(this.props.componentName,this.props.id)]=this}componentWillUnmount(){delete ie.listeners[ie.getKey(this.props.componentName,this.props.id)]}render(){return null}}ie.listeners={};class oe{constructor(e,t,s){this.uiApiHelper=e,this.componentName=t,this.id=s;const n=this;this.testids=new Proxy({},{get:(e,t,s)=>new ne(n.componentName,n.id,t).getTestId()}),this.dispatcher=new Proxy({},{get(i,o,r){var a=this;return function(){for(var i=arguments.length,r=new Array(i),l=0;l<i;l++)r[l]=arguments[l];return se(a,void 0,void 0,(function*(){const i=ie.listeners[ie.getKey(t,s)];if(!i)throw new Error("Trying to access UiApi, but listener is not mounted for: "+ie.getKey(t,s));console.debug("UiApi",t,s,o,r);const a=new ne(t,s,o,r);(yield e.onBeforeCallImplementation(void 0!==n._Listener,a))&&i.props.implementation[o].apply(i,r)}))}}})}get Listener(){return this._Listener||(this._Listener=e=>(0,n.jsx)(ie,{componentName:this.componentName,id:this.id,implementation:e.implementation},void 0)),this._Listener}}var re=function(e,t,s,n){return new(s||(s=Promise))((function(i,o){function r(e){try{l(n.next(e))}catch(t){o(t)}}function a(e){try{l(n.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,a)}l((n=n.apply(e,t||[])).next())}))};class ae{static get INSTANCE(){if(window.testsAreDemoMaster)throw new Error("UiApis should only exist in TADSlave. Trying to access it from TADMaster.");return ae._INSTANCE||(ae._INSTANCE=new ae),ae._INSTANCE}create(e){return t=>new oe(this,e,t=t||"")}onBeforeCallImplementation(e,t){return re(this,void 0,void 0,(function*(){if(!de._INSTANCE)return!0;let s;try{s=(0,R.getByTestId)(document.body,t.getTestId())}catch(n){const e=n+`\n\nThe component that emitted the event: does it have e.g. \ndata-testid={api.testids.${t.functionName}}\n?`;throw alert(e),n}if(de.INSTANCE.master.state.running)e||(de.INSTANCE.lastElementCaptured=s,yield be.showSpotlight({focusOnLastElementCaptured:!0,message:t.getTestId()}));else if(de.INSTANCE.master.refCaptureUiApiEvents.current)return yield de.INSTANCE.master.refCaptureUiApiEvents.current.onCapture(s,t.getGeneratedSourceCode());return!0}))}}var le,ce=function(e,t,s,n){return new(s||(s=Promise))((function(i,o){function r(e){try{l(n.next(e))}catch(t){o(t)}}function a(e){try{l(n.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,a)}l((n=n.apply(e,t||[])).next())}))};!function(e){e[e.SHOW=0]="SHOW",e[e.HIDE=1]="HIDE",e[e.HIDE_NEXT=2]="HIDE_NEXT"}(le||(le={}));class de extends i.Component{constructor(e){super(e),this.state={},this.uiApiHelper=ae.INSTANCE,this.stepByStep=!1,this.runRequestedWhileMochaInitializing=!1,this.onlyCalled=!1,this.onlyUntilCalled=!1,this.demoForEndUser=le.SHOW,this.onDocumentMouseMove=this.onDocumentMouseMove.bind(this),this.onDocumentClick=this.onDocumentClick.bind(this)}setLastElementCaptured(e){this.lastElementCaptured=e}componentDidMount(){var e,t,s;return ce(this,void 0,void 0,(function*(){if(de._INSTANCE)throw new Error("Cannot create more than one instances of TestsAreDemoSlave");if(de._INSTANCE=this,!(null===(e=window.parent)||void 0===e?void 0:e.testsAreDemoMaster))throw new Error("Looking at the parent of this IFrame to find TestsAreDemoMaster. But was not found.");this.master=window.parent.testsAreDemoMaster,this.master.slave=this;we((null===(s=(t=this.props).createTestsAreDemoFunctions)||void 0===s?void 0:s.call(t))||new je),this.initMocha()}))}initMocha(){return ce(this,void 0,void 0,(function*(){window.process||(window.process={browser:!0}),window.Buffer||(window.Buffer={isBuffer:()=>!1}),yield Promise.all([s.e(600),s.e(658)]).then(s.t.bind(s,65600,23)),mocha.setup({ui:"bdd",timeout:1e6});const e=this;mocha.reporter(class extends Mocha.reporters.Base{constructor(t,s){super(t,s),e.reporterFromSlaveToMaster=e.master.onMochaReporterCreated(this,t,s)}}),mocha.cleanReferencesAfterRun(!1),this.monkeyPatchMocha(),beforeEach((()=>{this.onlyUntilCalled=!1,this.demoForEndUser=le.SHOW,this.report=new te(this.master)})),afterEach((()=>ce(this,void 0,void 0,(function*(){yield this.report.sendMarkdownToPuppeteer()})))),de.mochaInitialized=!0,yield this.props.importTestsCallback(),_().use(X()),this.runRequestedWhileMochaInitializing&&this.run(),Error.stackTraceLimit=1/0}))}monkeyPatchMocha(){var e=this;const t=globalThis.it;if(t.onlyUntil)throw new Error("'it' already monkeypatched");const s=function(){if(e.onlyUntilCalled)return null;for(var s=arguments.length,n=new Array(s),i=0;i<s;i++)n[i]=arguments[i];return t.apply(null,n)};globalThis.it=s,s.only=t.only,s.skip=t.skip,s.retries=t.retries,s.onlyUntil=function(){if(!e.onlyCalled)throw new Error("'it.onlyUntil()' detected, but the parent suite should be 'describe.only()'");for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];const o=s.apply(null,n);return e.onlyUntilCalled=!0,o};const n=globalThis.describe,i=function(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return n.apply(null,t)};globalThis.describe=i,i.skip=n.skip,i.only=function(){e.onlyCalled=!0;for(var t=arguments.length,s=new Array(t),i=0;i<t;i++)s[i]=arguments[i];return n.only.apply(null,s)}}getMochaConstants(){return Mocha.Runner.constants}getTestsAreDemoFunctions(){return be}static get INSTANCE(){if(!de._INSTANCE)throw new Error("There is no TestsAreDemoSlave singleton available. This might happen if somehow you run tests that are NOT in the IFrame of TestsAreDemoMaster (i.e. in TestsAreDemoSlave)");return de._INSTANCE}run(){return ce(this,void 0,void 0,(function*(){if(!de.mochaInitialized)return void(this.runRequestedWhileMochaInitializing=!0);mocha.suite.suites=[];const e=be.addTestsFromDescriptors(this.master.state.testClassDescriptors,this.master.state.testsToRun,this.master.props.puppeteer);this.master.props.puppeteer&&(yield this.master.puppeteerBridge.sendMessageToPuppeteer("writeFile",{path:"testClassDescriptors.json",content:JSON.stringify(e)})),mocha.run((()=>{this.master.setState({running:!1}),this.master.readStepByStep()})).addListener("suite",(()=>{}))}))}showSpotlight(e,t){return ce(this,void 0,void 0,(function*(){let s;try{const e=Error.stackTraceLimit;let t;Error.stackTraceLimit=1/0;try{t=A().parse(new Error)}finally{Error.stackTraceLimit=e}for(let n of t)if(n.getFileName()&&n.getLineNumber()&&n.getColumnNumber()&&(s=yield P.INSTANCE.getSourceCodeState(n.getFileName(),n.getLineNumber(),n.getColumnNumber()),s&&(s.sourceFile.includes("TestsAreDemo.")||s.sourceFile.includes("TestsAreDemoInner.")))){this.master.setState({sourceCodeInfo:s});break}}catch(n){console.error("Error caught while trying to process the source map.",n)}this.master.enableNextStepButton(t),this.setState({spotlightParams:e}),this.report.onShowSpotlight(s,this.lastElementCaptured)}))}hideSpotlight(){return ce(this,void 0,void 0,(function*(){be.miniDb.removeHighlight(),this.setState({spotlightParams:void 0})}))}enableStepByStepProgrammatically(){if(this.master.state.stepByStepMode===Wt.OFF)throw new Error("You are calling 'enableStepByStepProgrammatically()', but 'Step by step' is not 'Controlled by program'. This function is meant to be used temporarily; maybe you forgot to remove it?");this.currentComment=null,this.stepByStep=!0}onDocumentMouseMove(e){let t=e.target,s=[];for(;t;){t.getAttribute(this.master.testIdProp)&&s.push(t),t=t.parentElement}0===s.length?(this.setState({inspectedElement:void 0}),s=void 0):this.setState({inspectedElement:s[0]}),this.master.setState({inspectedElements:s})}onDocumentClick(){this.toggleInspect()}toggleInspect(){this.master.state.inspecting?(document.removeEventListener("mousemove",this.onDocumentMouseMove),document.removeEventListener("click",this.onDocumentClick)):(document.addEventListener("mousemove",this.onDocumentMouseMove),document.addEventListener("click",this.onDocumentClick)),this.setState({inspectedElement:void 0}),this.master.setState({inspecting:!this.master.state.inspecting})}renderSpotlight(e,t){void 0===t&&(t="");return e.x-=5,e.y-=5,e.width+=10,e.height+=10,(0,n.jsx)("div",{className:"TestsAreDemo_spotlight "+t,style:{left:`${e.x}px`,top:`${e.y}px`,width:`${e.width}px`,height:`${e.height}px`}},void 0)}renderFloater(e,t){return(0,n.jsx)(Q.Z,{content:t,open:!0,styles:{options:{zIndex:10001},container:{borderRadius:"4px"},floater:{maxWidth:"800px"}},target:e},void 0)}render(){const e=(0,n.jsx)(he,{tads:this,spotlightParams:this.state.spotlightParams},void 0);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{id:"rtl",className:"flex-container flex-grow"},void 0),(0,n.jsx)("div",{id:"mocha"},void 0),this.state.spotlightParams&&this.lastElementCaptured&&this.state.spotlightParams.focusOnLastElementCaptured&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",Object.assign({className:"TestsAreDemo_overlay"},{children:[this.renderSpotlight(this.lastElementCaptured.getBoundingClientRect()),(0,n.jsxs)("div",Object.assign({className:"TestsAreDemo_screenshotPath"},{children:["Screenshot dir/file: ",this.reporterFromSlaveToMaster.currentClass,"/",this.reporterFromSlaveToMaster.currentFunction,"/",this.report.lastScreenshotName]}),void 0)]}),void 0),!this.master.props.forceStepByStep&&this.renderFloater(this.lastElementCaptured,e)]},void 0),this.state.spotlightParams&&(!this.lastElementCaptured||!this.state.spotlightParams.focusOnLastElementCaptured)&&(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(v.Z,Object.assign({open:!0},{children:(0,n.jsx)(v.Z.Content,{children:e},void 0)}),void 0)},void 0),this.state.inspectedElement&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",Object.assign({className:"TestsAreDemo_overlay"},{children:this.renderSpotlight(this.state.inspectedElement.getBoundingClientRect())}),void 0),this.state.inspectedElementPopup&&this.renderFloater(this.state.inspectedElement,this.state.inspectedElementPopup)]},void 0)]},void 0)}}function he(e){let{tads:t,spotlightParams:s}=e;const[o,r]=(0,i.useState)(null),[a,l]=(0,i.useState)(void 0);(0,i.useEffect)((()=>{"string"==typeof t.currentComment?r((0,n.jsx)(N,{children:t.currentComment},void 0)):r(t.currentComment),l(t.currentCommentSlideIndex),t.currentComment=void 0,t.currentCommentSlideIndex=void 0}),[]);let c=null==s?void 0:s.message;const d=!!c;return"string"==typeof c&&(c=(0,n.jsx)(N,{children:c},void 0)),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(h.Z,{circular:!0,color:"brown",content:t.report.lastScreenshotNumber},void 0),c,o&&(0,n.jsxs)(n.Fragment,{children:[d&&(0,n.jsx)(m.Z,{},void 0),(0,n.jsx)("p",{},void 0),o]},void 0)]},void 0)}de.mochaInitialized=!1;var ue=function(e,t,s,n){return new(s||(s=Promise))((function(i,o){function r(e){try{l(n.next(e))}catch(t){o(t)}}function a(e){try{l(n.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,a)}l((n=n.apply(e,t||[])).next())}))};class pe{constructor(){this.data={}}addRow(e,t,s){let n=this.data[e];n||(this.data[e]=n={}),n[t]=s}clear(){return this.data={},this.highlighted=void 0,this}populate(e){return ue(this,void 0,void 0,(function*(){throw new Error("Not implemented. Please create a subclass and implement this function according to your server backend/DB.")}))}get(e,t,s){var n;const i=this.data[e];if(!i)throw new Error("Cannot find entityName: "+e);const o=i[t];if(!o)throw new Error(`For entityName = ${e}, cannot find row w/ id = ${t}`);return this.highlighted={entityName:e,id:t,field:s},null===(n=de.INSTANCE.master.refMiniDbTableSetComponent.current)||void 0===n||n.forceUpdate(),o[s]}getDerived(e,t,s,n){const i=this.get(e,t,s);return"function"==typeof n?n.call(null,i):n}removeHighlight(){var e;this.highlighted=void 0,null===(e=de.INSTANCE.master.refMiniDbTableSetComponent.current)||void 0===e||e.forceUpdate()}}const me=e=>{let{children:t}=e;return(0,n.jsx)(n.Fragment,{children:t},void 0)};(0,R.configure)({getElementError:e=>new Error(e||"n/a")});const ge=/{s([0-9]+(?:\.[0-9]+)?)+}/;class ve{constructor(e){var t;if(this.lastSlideIndex=null,this.nextSlideIndex=null,this.text=e,!(null===(t=window.parent)||void 0===t?void 0:t.testsAreDemoMaster))throw new Error("Looking at the parent of this IFrame to find TestsAreDemoMaster. But was not found.");this.master=window.parent.testsAreDemoMaster}slide(e){if(!this.master.state.stepByStepMode)return;if(!this.nextSlideIndex){let e=this.text.match(ge);if(!e)throw new Error("Could not find any slides.");this.nextSlideIndex=Number(e[1]).valueOf(),this.text=this.splitTextBySlidePattern(e)[1]}if(e!==this.nextSlideIndex)throw this.text.match(`{s${e}`)||e===this.lastSlideIndex?new Error(`Last accesed slide: ${this.lastSlideIndex}. You should be now accesing slide: ${this.nextSlideIndex}. But you are accesing slide: ${e}.`):new Error(`You are trying to access slide: ${e}, but it does not exist.`);let t=this.text.match(ge);if(!t)return void this.updateSlideProperties(this.text,this.nextSlideIndex,"",-1);const s=Number(t[1]).valueOf();if(s<this.nextSlideIndex)throw new Error(`You are trying to access slide: ${e}. But we have found slide ${s} after slide ${e}. The slides should be in ascending order.`);let n=this.splitTextBySlidePattern(t);this.updateSlideProperties(n[0],this.nextSlideIndex,n[1],s)}splitTextBySlidePattern(e){const t=this.text.split(e[0]);if(t.length>2)throw new Error(`Slide ${e[1]} appears multiple times.`);return t}updateSlideProperties(e,t,s,n){de.INSTANCE.currentComment=e,de.INSTANCE.currentCommentSlideIndex=this.lastSlideIndex=t,this.text=s,this.nextSlideIndex=n}}var fe=function(e,t,s,n){return new(s||(s=Promise))((function(i,o){function r(e){try{l(n.next(e))}catch(t){o(t)}}function a(e){try{l(n.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,a)}l((n=n.apply(e,t||[])).next())}))};const xe=".<group>";class je{constructor(){this.waitForWhileException=R.waitFor,this.elementToObjectViaShortcutRefForTest=new Map,this.miniDb=new pe,this.nextTimeout=300;const e=this;this.createWrapperForDomSelectorFunction=this.createWrapperForDomSelectorFunction.bind(this),this.screenCapturing=this.iterateAndReplaceFunctions(Object.assign({},R.screen),this.createWrapperForDomSelectorFunction),this.assertWaitable=this.iterateAndReplaceFunctions(Object.assign({},Z.assert),((t,s)=>function(){for(var i=arguments.length,o=new Array(i),r=0;r<i;r++)o[r]=arguments[r];return fe(this,void 0,void 0,(function*(){let i=o[1];"object"==typeof i&&(i="Object ("+i.constructor.name+"): "+j.consoleLogJson(o[1],!1)),yield e.showSpotlight({focusOnLastElementCaptured:!0,message:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(h.Z,{color:"green",content:"Testing"},void 0),(0,n.jsx)(h.Z,{content:t},void 0),i&&(0,n.jsx)(h.Z,{content:i},void 0)]},void 0)}),s.apply(null,o)}))})),this.createWrapperForActionFunction=this.createWrapperForActionFunction.bind(this),this.userEventWaitable=this.iterateAndReplaceFunctions(Object.assign({},M.ZP),this.createWrapperForActionFunction),this.fireEventWaitable=this.iterateAndReplaceFunctions(Object.assign({},R.fireEvent),this.createWrapperForActionFunction),this.drag=this.createWrapperForActionFunction("drag",K)}getTestsAreDemoSlave(){return j.isTest()?void 0:de.INSTANCE}iterateAndReplaceFunctions(e,t,s){for(const n in e){if(s&&!s(n))continue;const i=t(n,e[n]);i&&(e[n]=i)}return e}createWrapperForActionFunction(e,t,s){void 0===s&&(s=null);const i=this;return function(){for(var o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];let l="";"type"===e&&(l=r[1]);const c=i.showSpotlight({focusOnLastElementCaptured:!0,message:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(h.Z,{color:"blue",content:"Will perform action"},void 0),(0,n.jsx)(h.Z,{content:e},void 0),l&&(0,n.jsx)(h.Z,{content:l},void 0)]},void 0)});if(!c)return t.apply(s,r);const d=new Promise((e=>{c.then((()=>{const n=t.apply(s,r);n instanceof Promise?n.then((t=>e(t))):e(c)}))}));return"type"!==e?d:new Promise((e=>d.then((t=>{var s;return null===(s=i.showSpotlight({focusOnLastElementCaptured:!0,message:"was typed"+l}))||void 0===s?void 0:s.then((()=>e(t)))}))))}}createWrapperForDomSelectorFunction(e,t){if(!this.getTestsAreDemoSlave())return t;const s=this;return e.startsWith("get")||e.startsWith("query")?function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];const o=t.apply(null,n);let r=o;return Array.isArray(o)&&(r=o[0]),s.getTestsAreDemoSlave().setLastElementCaptured(r),o}:e.startsWith("find")?function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];const o=t.apply(null,n);return o.then((e=>{let t=e;return Array.isArray(e)&&(t=e[0]),s.getTestsAreDemoSlave().setLastElementCaptured(t),t})),o}:null}withinCapturing(e,t){const s=(0,R.within)(e,t);return this.iterateAndReplaceFunctions(Object.assign({},s),this.createWrapperForDomSelectorFunction)}showSpotlight(e){var t;if(null===(t=this.getTestsAreDemoSlave())||void 0===t?void 0:t.stepByStep){if(this.getTestsAreDemoSlave().master.state.endUser){if(this.getTestsAreDemoSlave().demoForEndUser===le.HIDE)return;if(this.getTestsAreDemoSlave().demoForEndUser===le.HIDE_NEXT)return void this.demoForEndUserShow()}return"string"==typeof e&&(e={message:e}),e||(e={message:"",focusOnLastElementCaptured:!0}),new Promise((t=>this.getTestsAreDemoSlave().showSpotlight(e,t)))}}waitForWhile(e,t){return fe(this,void 0,void 0,(function*(){(t=t||{}).interval=t.interval||50,t.timeout=t.timeout||2e3;const s=Date.now();for(;yield e();)if(yield j.setTimeoutPromise((()=>null),t.interval),Date.now()-s>t.timeout)throw new Error("Timeout after having waited "+t.timeout+"ms and having retried each "+t.interval+"ms")}))}waitForCommunicationFinishedNextTimeoutTemp(e){this.nextTimeout=e}waitForCommunicationFinished(e){return fe(this,void 0,void 0,(function*(){yield j.setTimeoutPromise(void 0,this.nextTimeout),this.nextTimeout=300}))}enableStepByStep(){var e;null===(e=this.getTestsAreDemoSlave())||void 0===e||e.enableStepByStepProgrammatically()}getObjectViaCheat(e,t,s){var n;t instanceof HTMLElement&&(s=t,t=void 0);const i=U.INSTANCE.getClassName(e)+(t?"_"+t:""),o=(0,R.getByTestId)(s||document.body,i);return null===(n=this.getTestsAreDemoSlave())||void 0===n||n.setLastElementCaptured(o.parentElement),o.testsAreDemoCheat}getObjectViaCheatWaitable(e,t,s,n){const i=this.getObjectViaCheat(e,s,n),o=this;return new Proxy(i,{get:(e,s,n)=>o.createWrapperForActionFunction(t,e[s],e)})}getObjectViaShortcutRefForTestWaitable(e,t){var s;const n=U.INSTANCE.getClassName(e)+(t?"_"+t:""),i=(0,R.getByTestId)(document.body,n);null===(s=this.getTestsAreDemoSlave())||void 0===s||s.setLastElementCaptured(i);let o=this.elementToObjectViaShortcutRefForTest.get(i);return o||(o=this.iterateAndReplaceFunctions(i.testsAreDemoCheat,this.createWrapperForActionFunction,(e=>e.startsWith("tad"))),this.elementToObjectViaShortcutRefForTest.set(i,o)),o}wrapWithPropsSetter(e,t){let s={Component:()=>{const[o,r]=(0,i.useState)(e);return s.setProps=r,(0,n.jsx)(n.Fragment,{children:t(o)},void 0)},setProps:null};return s}renderWrappedWithPropsSetter(e,t,s){const i=be.wrapWithPropsSetter(e,t);return Object.assign(Object.assign({},function(e,t){const s=document.getElementById("rtl");return(0,R.render)(e,Object.assign({wrapper:me,container:s},t))}((0,n.jsx)(i.Component,{},void 0),s)),{setProps:i.setProps})}currentComment(e){this.getTestsAreDemoSlave()&&(this.getTestsAreDemoSlave().currentComment=e,this.getTestsAreDemoSlave().currentCommentSlideIndex=void 0)}cc(e){this.currentComment(e)}loadSlides(e){return fe(this,void 0,void 0,(function*(){const t=yield fetch(e);this.slides=new ve(yield t.text())}))}currentSlide(e){if(!this.slides)throw new Error("Slides not loaded. Use 'loadSlides()'.");this.slides.slide(e)}cs(e){this.currentSlide(e)}demoForEndUserHide(){this.getTestsAreDemoSlave()&&(this.getTestsAreDemoSlave().demoForEndUser=le.HIDE,this.getTestsAreDemoSlave().demoForEndUserSavedCurrentCommentBeforeHide=this.getTestsAreDemoSlave().currentComment)}demoForEndUserHideNext(){this.getTestsAreDemoSlave()&&(this.getTestsAreDemoSlave().demoForEndUser=le.HIDE_NEXT,this.getTestsAreDemoSlave().demoForEndUserSavedCurrentCommentBeforeHide=this.getTestsAreDemoSlave().currentComment)}demoForEndUserShow(){this.getTestsAreDemoSlave()&&(this.getTestsAreDemoSlave().demoForEndUser=le.SHOW,this.getTestsAreDemoSlave().currentComment=this.getTestsAreDemoSlave().demoForEndUserSavedCurrentCommentBeforeHide,this.getTestsAreDemoSlave().demoForEndUserSavedCurrentCommentBeforeHide=null)}addTests(){var e;const t=[];for(var s=arguments.length,n=new Array(s),i=0;i<s;i++)n[i]=arguments[i];for(let o of n)this.createTestClassDescriptor(t,void 0,o);null===(e=this.getTestsAreDemoSlave())||void 0===e||e.master.setState({testClassDescriptors:t})}createTestClassDescriptor(e,t,s){var n;const i=t?t+"."+s.name:s.name,o={testClass:s,name:i,functions:[],hooks:[]};e.push(o);const r=new s,a=Object.getPrototypeOf(r),l=H(a),c=Object.getOwnPropertyNames(a);let d,h=[];for(let u=0;u<c.length;u++){const e=c[u];if("function"!=typeof r[e]||"constructor"===e)continue;const t=r[e];if("annotation"===e){$(a,L),t.apply(r);continue}if(e.startsWith("annotation")){d=t;continue}if("before"===e||"after"===e||"beforeEach"===e||"afterEach"===e){o.hooks.push(e);continue}d&&($(a,e),d.apply(r));const s=l[e];e.startsWith("group")?h.push(e):s&&void 0!==s.scenario&&o.functions.push({functionName:e,scenario:s.scenario,comments:s.comments})}$(void 0,void 0),o.comments=null===(n=l[L])||void 0===n?void 0:n.comments;for(let u of h)this.createTestClassDescriptor(e,i,r[u]())}addTestsFromDescriptors(e,t,s){const n=[],i=s&&!t;if(e&&(i||t)){for(let s of e)(i||t[s.name]&&0!==Object.getOwnPropertyNames(t[s.name]).length)&&describe(s.name,(()=>{const e=Object.assign(Object.assign({},s),{functions:[]});n.push(e);const o=new s.testClass;for(let t of s.hooks){const e=o[t].bind(o);if("before"===t)before(e);else if("after"===t)after(e);else if("beforeEach"===t)beforeEach(e);else{if("afterEach"!==t)throw new Error("Unexpected hook: "+t);afterEach(e)}}for(let n of s.functions){if(!i&&!t[s.name][n.functionName])continue;e.functions.push(n);const r=o[n.functionName].bind(o);it(n.functionName,r)}}));return n}}getFunctionsThatNeedOnly(e,t){var s,n,i,o;const r=new Array(t.length),a=new Array(t.length);let l=!1;for(let d=0;d<t.length;d++){const o=null==e?void 0:e[t[d]];((null===(s=null==o?void 0:o.options)||void 0===s?void 0:s.runOnlyThisScenario)||l)&&(r[d]=!0,l=null===(n=null==o?void 0:o.options)||void 0===n?void 0:n.linkWithNextScenario),d<t.length-1&&(a[d+1]=null===(i=null==o?void 0:o.options)||void 0===i?void 0:i.linkWithNextScenario)}let c=!1;for(let d=t.length-1;d>=0;d--){const s=null==e?void 0:e[t[d]];((null===(o=null==s?void 0:s.options)||void 0===o?void 0:o.runOnlyThisScenario)||c)&&(r[d]=!0,c=a[d])}return r}}let be;function we(e){if(window.testsAreDemoMaster){be=new Proxy({},{get(e,t,s){throw new Error("Attempting to use 'tad' outside the slave IFrame (which runs the test). Please review the stack trace to understand who's doing this illegal call.")}})}else be=e}function Te(e,t){for(let s in t)t[s]=e+"_"+s;return t}var Se=function(e,t,s,n){return new(s||(s=Promise))((function(i,o){function r(e){try{l(n.next(e))}catch(t){o(t)}}function a(e){try{l(n.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,a)}l((n=n.apply(e,t||[])).next())}))};class ye{constructor(e,t,s,n){this.master=e,this.reporter=t,this.runner=s,this.options=n,this._indents=0,this.testFailed=!1,this.currentClass="",this.currentFunction="",this.onTestFail=this.onTestFail.bind(this),this.onEnd=this.onEnd.bind(this);const{EVENT_RUN_BEGIN:i,EVENT_RUN_END:o,EVENT_TEST_FAIL:r,EVENT_TEST_PASS:a,EVENT_SUITE_BEGIN:l,EVENT_SUITE_END:c,EVENT_TEST_BEGIN:d,EVENT_TEST_END:h}=this.master.slave.getMochaConstants();s.once(i,(()=>{this.log("start")})).on(l,(e=>{this.currentClass=j.substringBefore(e.title,xe),this.increaseIndent(e.title),this.log(this.indent()+"[suite] "+e.title)})).on(c,(()=>{this.decreaseIndent()})).on(d,(e=>{this.currentFunction=e.title,this.testFailed=!1,this.increaseIndent(e.title),this.log(this.indent()+"[test begin] "+e.title)})).on(h,(()=>{this.decreaseIndent()})).on(a,(e=>{this.log(`${this.indent()}[test passed] ${e.title}`)})).on(r,this.onTestFail).once(o,this.onEnd)}indent(){return Array(this._indents).join("  ")}getDirFromPath(e){let t="";return e.length>=1&&(t=e[e.length-1]),e.length>=2&&(e[e.length-2].startsWith(xe)?e.length>=3&&(t=e[e.length-3]+"."+t):t=e[e.length-2]+"."+t),t}increaseIndent(e){this._indents++}decreaseIndent(){this._indents--}consoleLog(e){console.log(e)}log(e){this.consoleLog(e),this.master.log(e)}onTestFail(e,t){return Se(this,void 0,void 0,(function*(){if(this.testFailed=!0,this.log(`${this.indent()}[test failed] (**look in the console for the clickable stacktrace**): ${e.title}. Error = ${t}`),this.consoleLog("Test '"+e.title+"' has failed w/ the following error (should have clickable stacktrace):"),console.log("*** Printing error w/ the old method"),this.consoleLog(t),"Error"!==Object.getPrototypeOf(t).name){const e=new Error;e.stack=t.stack,console.log("Printing the error again, to make sure we have a clickable stacktrace:"),console.log(e)}console.log("*** Printing the error w/ the new method (decoding the stack trace via source maps)");const s=this.master.slave.report;s.waitForError();const n=yield P.INSTANCE.decodeStackTrace(t);this.consoleLog(n),s.errorArrived(n)}))}onEnd(){const e=this.runner.stats;this.log(`end: ${e.passes}/${e.passes+e.failures} ok`),this.master.props.puppeteer&&this.master.sendMessageToPuppeteer("finished",this.runner.stats)}}var Ce=s(92589),Ee=function(e,t){var s={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(s[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(s[n[i]]=e[n[i]])}return s};const Ne="currentLine",Ie="code",De=Te("TestsAreDemoMaster",{line:"",code:""});class Ae extends i.Component{adjustScrollbarsIfNeededToHaveCurrentLineElementInViewport(){const e=document.getElementById(Ne);if(!e)return;const t=document.getElementById(Ie);var s=t.scrollTop,n=s+t.offsetHeight;let i=t.offsetHeight-t.clientHeight;var o=e.offsetTop,r=o+e.offsetHeight+i;(s>o||n<r)&&e.scrollIntoView()}componentDidUpdate(e){this.props.sourceCodeInfo&&e.sourceCodeInfo!=this.props.sourceCodeInfo&&this.adjustScrollbarsIfNeededToHaveCurrentLineElementInViewport()}render(){var e;const t=this.props.sourceCodeInfo;return(null==t?void 0:t.sourceCode)?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("span",{children:["File@line: ",(0,n.jsx)("b",{children:j.substringAfter(t.sourceFile,"/",!0)},void 0),"@",t.sourceLine," \xa0",(0,n.jsx)(d.Z,{trigger:(0,n.jsx)(a.Z,{icon:"bars",size:"mini"},void 0),flowing:!0,on:"click",pinned:!0,content:(0,n.jsxs)(n.Fragment,{children:["Full file name: ",(0,n.jsx)("b",{children:null===(e=t.sourceFile)||void 0===e?void 0:e.split("..").pop()},void 0),(0,n.jsx)("p",{},void 0),(0,n.jsx)(a.Z,{size:"mini",content:"Print it to console",onClick:()=>{var e;console.log("Printing the file name, in a clickable form:"),t.sourceFile?console.log(window.location.origin+(null===(e=t.sourceFile)||void 0===e?void 0:e.split("..").pop())+":"+t.sourceLine):console.log("The source file is undefined")}},void 0),"Then open DevTools (e.g. via ",(0,n.jsx)(h.Z,{size:"mini",content:"F12"},void 0),") and click on the file name (to open it in DevTools)."]},void 0)},void 0)]},void 0),(0,n.jsx)(Oe,Object.assign({highlightSourceLine:t.sourceLine},{children:t.sourceCode}),void 0)]},void 0):(0,n.jsx)(n.Fragment,{children:"SourceCode not yet loaded"},void 0)}}function Oe(e){const{highlightSourceLine:t}=e,s=Ee(e,["highlightSourceLine"]);return(0,n.jsx)(C.Z,Object.assign({id:"SyntaxHighlighter",className:"no-padding-margin flex-container flex-grow",codeTagProps:{"data-testid":De.code,id:Ie,className:"language-javascript flex-grow"},language:"javascript",style:Ce.Z,wrapLines:!0,showLineNumbers:!0,lineProps:e=>{let s={background:e===t?"#dbffdb":"#0000"};return{"data-testid":De.line+"_"+e,style:s,id:e===t?Ne:void 0}}},s),void 0)}const ke=e=>{var t;const[s,o]=(0,i.useState)(-1),[a,l]=(0,i.useState)(-1),c=t=>{if(e.getIdForLocalStorage)return e.getIdForLocalStorage(t);if("string"==typeof t)return t;throw new Error("item is not string; please provide getIdForLocalStorage")},d=function(t,s,n){void 0===n&&(n=!1),l(s),e.onSelect(t),!n&&e.localStorageKey&&localStorage.setItem(e.localStorageKey,c(t))};return(0,i.useEffect)((()=>{var t;if(e.items&&e.localStorageKey){const s=e.selectedImposed||localStorage.getItem(e.localStorageKey);if(!s)return;for(let n=0;n<(null===(t=e.items)||void 0===t?void 0:t.length);n++)if(s===c(e.items[n]))return void d(e.items[n],n,!0)}}),[e.items]),(0,n.jsx)(r.Z.Group,{children:null===(t=e.items)||void 0===t?void 0:t.map(((t,i)=>(0,n.jsx)(r.Z,Object.assign({secondary:i===s,tertiary:i===a,onMouseEnter:()=>o(i),onMouseLeave:()=>o(-1),onClick:()=>d(t,i)},{children:e.renderItem(t)}),i)))},void 0)},Fe="recordedTests/";const Pe={MESSAGE_FOR_PUPPETEER:"MESSAGE_FOR_PUPPETEER",RECORDED_TESTS_INDEX:"recordedTestsIndex.json",RECORDED_TESTS_DIR:Fe,generateMarkdownDoc:async function(e){let t="";const s=[[]];let n,i=0;for(n of e.cells)s[s.length-1].push(n),i++,(i>=4||n.newLineAfter)&&(s.push([]),i=0);let o,r=0;for(o of s){for(n of(t+="<table>\n<tr>\n",o))t+=`<th>Fig. ${++r}</th>\n`;for(n of(t+="</tr>\n<tr>\n",o))t+=`<td>\n<div align="center">\n<details><summary>Click to expand full image</summary>\n\n![](${Fe}${n.image})\n\n</details>\n\n![](${Fe}${n.image.replace(".png","_small.png")})\n\n<br />\n\n${n.text}\n\n</div>\n</td>\n`;t+="</tr>\n</table>\n"}return t}};var Re=function(e,t,s,n){return new(s||(s=Promise))((function(i,o){function r(e){try{l(n.next(e))}catch(t){o(t)}}function a(e){try{l(n.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,a)}l((n=n.apply(e,t||[])).next())}))};const{generateMarkdownDoc:Me}=Pe;class Ze extends i.Component{constructor(){super(...arguments),this.state={}}componentDidMount(){return Re(this,void 0,void 0,(function*(){const e=yield fetch("docDescriptors/index.json");if(!e.ok)return;const t=yield e.text();this.setState({descriptors:JSON.parse(t)})}))}loadDescriptor(e){return Re(this,void 0,void 0,(function*(){try{const t=yield fetch("docDescriptors/"+e);if(!t.ok)throw new Error;const s=yield t.text(),n=JSON.parse(s);this.setState({markdown:yield Me(n)})}catch(t){this.setState({markdown:void 0})}}))}render(){return(0,n.jsxs)(x,Object.assign({size:"25%",split:"vertical"},{children:[(0,n.jsx)("div",Object.assign({className:"w100"},{children:(0,n.jsx)(ke,{items:this.state.descriptors,localStorageKey:ss,renderItem:e=>e,onSelect:e=>this.loadDescriptor(e)},void 0)}),void 0),(0,n.jsx)(N,{children:this.state.markdown},void 0),";"]}),void 0)}}var _e=function(e,t,s,n){return new(s||(s=Promise))((function(i,o){function r(e){try{l(n.next(e))}catch(t){o(t)}}function a(e){try{l(n.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,a)}l((n=n.apply(e,t||[])).next())}))};const{RECORDED_TESTS_INDEX:Ue,RECORDED_TESTS_DIR:Le}=Pe;class Be extends i.Component{constructor(){super(...arguments),this.state={}}componentDidMount(){return _e(this,void 0,void 0,(function*(){const e=yield fetch(Le+Ue);if(!e.ok)return;const t=yield e.text();this.setState({dirs:JSON.parse(t)})}))}loadDir(e){return _e(this,void 0,void 0,(function*(){try{const t=yield fetch(Le+e+"/report.md");if(!t.ok)throw new Error;const s=yield t.text();this.setState({currentDir:e,markdown:s})}catch(t){this.setState({markdown:void 0})}}))}render(){return(0,n.jsxs)(x,Object.assign({size:"25%",split:"vertical"},{children:[(0,n.jsx)("div",Object.assign({className:"w100"},{children:(0,n.jsx)(ke,{items:this.state.dirs,localStorageKey:ns,onSelect:e=>this.loadDir(e),renderItem:e=>(0,n.jsx)(n.Fragment,{children:e},void 0)},void 0)}),void 0),(0,n.jsx)(N,Object.assign({baseUrlForImages:Le+this.state.currentDir},{children:this.state.markdown}),void 0),";"]}),void 0)}}var We=s(92175),$e=s(11671),He=s(9115),ze=s.n(He),Ve=s(50072),qe=s(69122);class Je extends i.Component{constructor(e){super(e);const t={currentSlide:0};this.state=t,t.currentSlide=e.currentSlide||0}renderComponent(){let e,t;const{recordedTest:s}=this.props;if(s&&s.slides.length>0){const n=s.slides[this.state.currentSlide];e={sourceCode:s.sourceFiles[n.sourceFile],sourceFile:n.sourceFile,sourceLine:n.sourceLine,sourceColumn:0},t=this.props.testPath+"/"+s.slides[this.state.currentSlide].screenshot+".png"}return(0,n.jsxs)("div",Object.assign({className:"RecordedTestModal"},{children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)(a.Z.Group,Object.assign({basic:!0},{children:[(0,n.jsx)(a.Z,{icon:"step backward",disabled:this.state.currentSlide<=0,onClick:()=>this.setState({currentSlide:this.state.currentSlide-1})},void 0),(0,n.jsx)(a.Z,{icon:"step forward",disabled:this.state.currentSlide>=s.slides.length-1,onClick:()=>this.setState({currentSlide:this.state.currentSlide+1})},void 0)]}),void 0),s&&s.slides.map(((e,t)=>(0,n.jsx)(h.Z,{as:"a",circular:!0,content:t+1,color:t===this.state.currentSlide?"blue":void 0,size:t===this.state.currentSlide?"huge":void 0,onClick:()=>this.setState({currentSlide:t})},t)))]},void 0),s&&(0,n.jsxs)(x,Object.assign({size:"25%",split:"vertical"},{children:[(0,n.jsx)("div",Object.assign({className:"flex-grow flex-container no-padding-margin"},{children:(0,n.jsx)(Ae,{sourceCodeInfo:e},void 0)}),void 0),(0,n.jsx)("div",{children:(0,n.jsx)("img",{src:t},void 0)},void 0)]}),void 0)]}),void 0)}render(){return(0,n.jsxs)(v.Z,Object.assign({className:"RecordedTestModalRoot",open:!0,size:"fullscreen",onClose:this.props.onClose},{children:[(0,n.jsx)(rt,Object.assign({},this.props,{parent:void 0,testFunctionDescriptor:this.props.parent.props.testFunctionDescriptor,recordedTest:this.props.recordedTest,additionalForSegment2:(0,n.jsxs)(n.Fragment,{children:["Recorded test URL: ",this.props.testPath]},void 0)}),void 0),this.renderComponent(),(0,n.jsx)(v.Z.Actions,{children:(0,n.jsx)(a.Z,Object.assign({onClick:this.props.onClose},{children:"Close"}),void 0)},void 0)]}),void 0)}}var Ge=function(e,t,s,n){return new(s||(s=Promise))((function(i,o){function r(e){try{l(n.next(e))}catch(t){o(t)}}function a(e){try{l(n.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,a)}l((n=n.apply(e,t||[])).next())}))};function Ke(e){let t=0,s=0;if(e)for(let n of Object.values(e)){const e=Object.getOwnPropertyNames(n).length;0!==e&&(t++,s+=e)}return{classesChecked:t,functionsChecked:s}}function Ye(e){const t=Ke(e);return`${t.functionsChecked}t (${t.classesChecked}c)`}function Xe(e){let t=0,s=0;return null==e||e.forEach((e=>{t++,s+=e.functions.length})),`${s}t (${t}c)`}function Qe(e,t){const s=new URLSearchParams(window.location.search);return s.delete(e),s.append(e,t),window.location.href+"?"+s.toString()}function et(e,t){return Ge(this,void 0,void 0,(function*(){const s=yield fetch(e,{credentials:t?"include":void 0});if(!s.ok)throw new Error("Request failed. See the browser's network tab for details. URL: "+e);return yield s.json()}))}var tt=function(e,t,s,n){return new(s||(s=Promise))((function(i,o){function r(e){try{l(n.next(e))}catch(t){o(t)}}function a(e){try{l(n.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,a)}l((n=n.apply(e,t||[])).next())}))},st=function(e,t){var s={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(s[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(s[n[i]]=e[n[i]])}return s};class nt extends i.Component{constructor(e){super(e),this.state={}}componentDidUpdate(e){return tt(this,void 0,void 0,(function*(){if(this.props.recordedTestsUrl&&(e.expanded!==this.props.expanded&&this.setState({recordedTest:void 0}),this.props.expanded&&(e.expanded!==this.props.expanded||e.recordedTestsUrl!==this.props.recordedTestsUrl||e.testClassDescriptor!==this.props.testClassDescriptor||!ze().isEqual(e.testFunctionDescriptor,this.props.testFunctionDescriptor)))){const e=yield et(this.getUrl()+"/recordedTest.json",this.props.includeCredentialsInJsonRequest);this.setState({recordedTest:e})}}))}getUrl(){var e;const t=this.props;return j.substringBefore(t.recordedTestsUrl,"/",!0)+"/"+(null===(e=t.testClassDescriptor)||void 0===e?void 0:e.name)+"/"+t.testFunctionDescriptor.functionName+"/"}render(){return(0,n.jsx)(rt,Object.assign({},this.props,{recordedTest:this.state.recordedTest,parent:this}),void 0)}}const ot=e=>(0,n.jsx)(N,{children:e.comment},void 0);function rt(e){var t,s;let{master:i,testClassDescriptor:o,testsToRun:c,testFunctionDescriptor:d,recordedTest:u,parent:p}=e,m=st(e,["master","testClassDescriptor","testsToRun","testFunctionDescriptor","recordedTest","parent"]);return(0,n.jsxs)("div",Object.assign({className:"TestFunctionComponent"},{children:[(0,n.jsxs)(l.Z,Object.assign({className:"TestFunctionComponent_segment1",attached:!0},{children:[p&&!m.recordedTestsUrl&&(0,n.jsx)(g.Z,{label:"\xa0",checked:!0===(null===(t=null==c?void 0:c[o.name])||void 0===t?void 0:t[d.functionName]),onChange:()=>{c||(c={}),null==i||i.updateTestsToRun((0,We.Uy)(c,(e=>{let t=e[o.name];t||(t=e[o.name]={}),t[d.functionName]?delete t[d.functionName]:t[d.functionName]=!0})))}},void 0),(0,n.jsxs)("h3",{children:[m.recordedTestsUrl&&(0,n.jsx)(Ve.Z,{name:(m.expanded?"minus":"plus")+" square outline",link:!0,onClick:e=>{var t;return null===(t=m.onToggleExpanded)||void 0===t?void 0:t.call(m)}},void 0),d.scenario]},void 0)," \xa0",(0,n.jsx)(h.Z,Object.assign({horizontal:!0},{children:d.functionName}),void 0)]}),void 0),u&&(0,n.jsxs)(l.Z,Object.assign({className:"TestFunctionComponent_segment2",attached:!!p||"bottom",warning:!0},{children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(h.Z,{horizontal:!0,circular:!0,color:"orange",size:"small",content:"R"},void 0),"Recorded test ",p&&(0,n.jsx)("a",Object.assign({href:"#",onClick:e=>{p.setState({modalOpenAtScreenshotWithIndex:0}),e.preventDefault()}},{children:"(open)"}),void 0),"\xa0",m.showThumbnails&&(0,n.jsx)("br",{},void 0),(0,n.jsx)(h.Z,Object.assign({horizontal:!0,basic:!0,color:u.error?"red":"green"},{children:u.error?"FAILED":"PASSED"}),void 0),(0,n.jsxs)(h.Z,Object.assign({horizontal:!0,basic:!0},{children:["Duration: ",u.duration," ms"]}),void 0),m.additionalForSegment2]},void 0),p&&m.showThumbnails&&u.slides.map(((e,t)=>(0,n.jsx)(qe.Z,{as:"a",href:"",src:p.getUrl()+e.screenshot+".png",size:"tiny",bordered:!0,onClick:e=>{p.setState({modalOpenAtScreenshotWithIndex:t}),e.preventDefault()}},e.screenshot))),p&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(a.Z,{icon:"images outline",onClick:m.onToggleShowThumbnails,content:m.showThumbnails?"Hide thumbnails":"Show thumbnails"},void 0),(0,n.jsx)(a.Z,{icon:"film",onClick:e=>p.setState({modalOpenAtScreenshotWithIndex:0}),content:"Open"},void 0)]},void 0)]}),void 0),void 0!==(null==p?void 0:p.state.modalOpenAtScreenshotWithIndex)&&(0,n.jsx)(Je,{parent:p,recordedTest:p.state.recordedTest,onClose:()=>p.setState({modalOpenAtScreenshotWithIndex:void 0}),testPath:p.getUrl(),currentSlide:p.state.modalOpenAtScreenshotWithIndex},void 0),p&&(null===(s=d.comments)||void 0===s?void 0:s.map(((e,t)=>(0,n.jsx)(r.Z,Object.assign({attached:t!=d.comments.length-1||"bottom",className:0===t?"TestFunctionComponent_segment3":""},{children:(0,n.jsx)(ot,{comment:e},void 0)}),t))))]}),void 0)}var at=function(e,t){var s={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(s[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(s[n[i]]=e[n[i]])}return s};class lt extends i.Component{constructor(){super(...arguments),this.state={}}render(){var e;let t=this.props,{master:s,testClassDescriptor:i,testsToRun:o}=t,a=at(t,["master","testClassDescriptor","testsToRun"]);const l=(null==i?void 0:i.name)||"There are no tests";return(0,n.jsxs)("div",Object.assign({className:"TestClassComponent"},{children:[(0,n.jsx)("div",Object.assign({className:"TestClassComponent_header"},{children:(0,n.jsx)("h1",{children:l},void 0)}),void 0),(0,n.jsx)(m.Z,{className:"TestClassComponent_divider"},void 0),(null==i?void 0:i.comments)&&(0,n.jsx)($e.Z,{children:null===(e=null==i?void 0:i.comments)||void 0===e?void 0:e.map(((e,t)=>(0,n.jsx)(r.Z,{children:(0,n.jsx)(N,{children:e},void 0)},t)))},void 0),null==i?void 0:i.functions.map(((e,t)=>(0,n.jsx)(nt,{master:s,includeCredentialsInJsonRequest:a.includeCredentialsInJsonRequest,testClassDescriptor:i,testsToRun:o,testFunctionDescriptor:e,recordedTestsUrl:a.recordedTestsUrl,expanded:this.state.expanded,onToggleExpanded:()=>this.setState({expanded:!this.state.expanded}),showThumbnails:this.state.showThumbnails,onToggleShowThumbnails:()=>this.setState({showThumbnails:!this.state.showThumbnails})},t)))]}),void 0)}}class ct extends i.Component{constructor(e){super(e),this.state={},this.componentDidUpdate()}componentDidUpdate(e){const t=this.props;if(t.testClassDescriptors===(null==e?void 0:e.testClassDescriptors)||!t.testsToRun)return;let s=!1;const n=(0,We.Uy)(t.testsToRun,(e=>{for(let n of Object.getOwnPropertyNames(e)){const i=t.testClassDescriptors.find((e=>e.name===n));if(!i){delete e[n],s=!0;continue}const o=e[n];for(let e of Object.getOwnPropertyNames(o))i.functions.find((t=>t.functionName===e))||(delete o[e],s=!0)}}));s&&t.master.updateTestsToRun(n)}getShowLeftPane(){return!0}getTestClassDescriptors(){return this.props.testClassDescriptors}getAdditionalPropsForFeatureList(){return{localStorageKey:os}}getAdditionalPropsForTestClassComponent(){}renderTestClassComponent(){let{testsToRun:e,master:t}=this.props;return(0,n.jsx)(lt,Object.assign({master:t,testsToRun:e,testClassDescriptor:this.state.selectedDescriptor},this.getAdditionalPropsForTestClassComponent()),void 0)}render(){let{testsToRun:e,master:t}=this.props;if(!this.getShowLeftPane())return this.renderTestClassComponent();let s,i=e&&JSON.stringify(e);if(i){s=Qe(cs,i);const e=new URLSearchParams;e.append(cs,i),i="\\&"+e.toString()}const o=Ke(e);return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)(x,Object.assign({size:"25%",split:"vertical"},{children:[(0,n.jsxs)("div",Object.assign({className:"w100"},{children:[!this.getAdditionalPropsForTestClassComponent()&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(d.Z,Object.assign({flowing:!0,on:"click",trigger:(0,n.jsx)(a.Z,{icon:"linkify",content:"Link"},void 0)},{children:i?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("p",{children:[Ye(e),": there are ",o.functionsChecked," test function(s) (in ",o.classesChecked," class(es)) checked to be ran."]},void 0),(0,n.jsxs)("p",{children:[(0,n.jsx)(h.Z,{circular:!0,content:"1"},void 0)," This ",(0,n.jsx)("a",Object.assign({href:s,target:"_blank"},{children:"shareable link"}),void 0)," contains in its search string the JSON for the checked tests to run."]},void 0),(0,n.jsxs)("p",{children:[(0,n.jsx)(h.Z,{circular:!0,content:"2"},void 0)," When launched from ",(0,n.jsx)("b",{children:"puppeteer"},void 0),", all the tests are ran. If you want to ",(0,n.jsx)("b",{children:"filter"},void 0),", then you can append a command line fragment to the puppeteer command line e.g. ",(0,n.jsx)(h.Z,Object.assign({horizontal:!0},{children:(0,n.jsx)("code",{children:"tad-puppeteer \\&testsToRun=..."},void 0)}),void 0),":"]},void 0),(0,n.jsx)(l.Z,{children:(0,n.jsx)("code",{children:i},void 0)},void 0),(0,n.jsx)(a.Z,{content:"Copy to clipboard",onClick:()=>{navigator.clipboard.writeText(i),alert("Copied to clipboard!")}},void 0)]},void 0):"No test is checked to run"}),void 0),(0,n.jsx)(a.Z,{disabled:this.props.running,icon:"play",content:"Run "+Ye(e),onClick:e=>t.run(!0)},void 0)]},void 0),this.getTestClassDescriptors()&&(0,n.jsx)(h.Z,Object.assign({basic:!0,horizontal:!0,color:"grey"},{children:Xe(this.getTestClassDescriptors())}),void 0),(0,n.jsx)(ke,Object.assign({items:this.getTestClassDescriptors(),getIdForLocalStorage:e=>e.name,onSelect:e=>this.setState({selectedDescriptor:e}),renderItem:s=>{const i=e&&e[s.name]&&Object.getOwnPropertyNames(e[s.name]).length>0;return(0,n.jsxs)(n.Fragment,{children:[!this.getAdditionalPropsForTestClassComponent()&&(0,n.jsx)(g.Z,{checked:i,label:"\xa0",onChange:()=>{e||(e={}),null==t||t.updateTestsToRun((0,We.Uy)(e,(e=>{if(i)delete e[s.name];else{const t=e[s.name]={};for(let e of s.functions)t[e.functionName]=!0}})))}},void 0),s.name]},void 0)}},this.getAdditionalPropsForFeatureList()),void 0)]}),void 0),this.renderTestClassComponent()]}),void 0)},void 0)}}var dt=s(28335),ht=s(92326),ut=s(12618),pt=s(29792),mt=s(29309);const gt=e=>{var t;const[s,o]=(0,i.useState)(-1),[l,c]=(0,i.useState)(-1),[d,h]=(0,i.useState)("");(0,i.useEffect)((()=>c(e.selectedIndexOnce||-1)),[e.selectedIndexOnce]);let u=-1;return(0,n.jsxs)("div",Object.assign({className:"w100"},{children:[e.onSetCurrent&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(mt.Z,{icon:"search",iconPosition:"left",placeholder:"Search...",value:d,action:d?{icon:"delete",color:"red",onClick:()=>h("")}:void 0,onChange:(e,t)=>h(t.value)},void 0)," (For found items, shows children, but doesn't show parents)"]},void 0),(0,n.jsx)(r.Z.Group,{children:null===(t=e.linearizedItems)||void 0===t?void 0:t.map(((t,i)=>d&&((u<0||t.indent<=u)&&(u=-1,t.name.toLowerCase().indexOf(d.toLowerCase())>=0&&(u=t.indent)),u<0)?null:(0,n.jsxs)(r.Z,Object.assign({secondary:i===s,tertiary:i===l,onMouseEnter:()=>o(i),onMouseLeave:()=>o(-1),onClick:()=>{var s;c(i),null===(s=e.onSelect)||void 0===s||s.call(e,t)}},{children:[(0,n.jsx)(vt,{width:t.indent},void 0),"CLASS"===t.kind?(0,n.jsx)(jt,{},void 0):(0,n.jsx)(bt,{},void 0),"\xa0",t.report&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(wt,{},void 0),"\xa0"]},void 0),t.failure&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Tt,{},void 0),"\xa0"]},void 0),(0,n.jsx)("span",Object.assign({style:{color:"METHOD"===t.kind?"#b1b1b1":void 0}},{children:t.name}),void 0)," ",(0,n.jsx)("i",Object.assign({style:{color:"#2185d0"}},{children:(0,n.jsx)(N,{children:t.description},void 0)}),void 0),e.onSetCurrent&&(0,n.jsx)(a.Z,{size:"mini",floated:"right",primary:!0,content:"Set current",onClick:()=>{var s;return null===(s=e.onSetCurrent)||void 0===s?void 0:s.call(e,t)}},void 0)]}),i)))},void 0)]}),void 0)},vt=e=>{let{width:t}=e;return(0,n.jsx)(n.Fragment,{children:new Array(4*t).fill(0).map(((e,t)=>(0,n.jsx)(i.Fragment,{children:"\xa0"},t)))},void 0)};var ft=function(e,t,s,n){return new(s||(s=Promise))((function(i,o){function r(e){try{l(n.next(e))}catch(t){o(t)}}function a(e){try{l(n.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,a)}l((n=n.apply(e,t||[])).next())}))};class xt extends i.Component{constructor(){super(...arguments),this.state={}}fetchSafe(e,t){return ft(this,void 0,void 0,(function*(){const s=yield fetch(e,t);if(500===s.status){const e=yield s.json();throw this.setState({serverError:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("b",{children:"Path:"},void 0)," ",e.path,(0,n.jsx)("br",{},void 0),(0,n.jsx)("b",{children:"Message:"},void 0)," ",e.message]},void 0)}),new Error("Server error")}return s}))}componentDidMount(){return ft(this,void 0,void 0,(function*(){const e=yield(yield this.fetchSafe(this.props.serverUrlPrefix+"testGoodiesController/getTestsTree")).json(),t=this.linearizeNode(e,[],-1);this.setState({testsTreeRoot:e,linearizedItems:t}),this.setCurrent(localStorage.getItem(es),localStorage.getItem(ts))}))}runCurrent(){return ft(this,void 0,void 0,(function*(){this.setState({currentSelectedIndexAfterRun:void 0});let e=`${this.props.serverUrlPrefix}testGoodiesController/runTest?className=${this.state.currentClassName}`;this.state.currentMethodName&&(e+=`&methodName=${this.state.currentMethodName}`);const t=yield(yield this.fetchSafe(e)).json(),s=this.linearizeNode(t,[],-1);this.setState({testsTreeRoot:t,linearizedItems:s});const n=this.setCurrent(this.state.currentClassName,this.state.currentMethodName);this.setState({selectedItem:null==n?void 0:n.foundItem,currentSelectedIndexAfterRun:null==n?void 0:n.foundIndex})}))}linearizeNode(e,t,s,n,i){if(s++,n&&s<n.length&&n[s]!==e.name)return t;e.indent=s,s>0&&t.push(e),n&&s===n.length-1&&(i.foundIndex=t.length-1,i.foundItem=e);for(let o of e.children)n||(o.parent=e),this.linearizeNode(o,t,s,n,i);return t}setCurrent(e,t,s){null===e&&(e=void 0),null===t&&(t=void 0);const n={};if(e){const s=[];if(!this.deduceFullPath(this.state.testsTreeRoot,e,t,!1,s))return;const i=this.linearizeNode(this.state.testsTreeRoot,[],-1,s,n);this.setState({linearizedItemsCurrent:i})}else this.setState({linearizedItemsCurrent:void 0});return this.setState({currentClassName:e,currentMethodName:t}),s||(e?localStorage.setItem(es,e):localStorage.removeItem(es),t?localStorage.setItem(ts,t):localStorage.removeItem(ts)),n}deduceFullPath(e,t,s,n,i){if(n){if(e.name===s)return i.splice(0,0,e.name),!0}else if(e.name===t){if(!s)return i.splice(0,0,e.name),!0;n=!0}for(let o of e.children)if(this.deduceFullPath(o,t,s,n,i))return i.splice(0,0,e.name),!0;return!1}render(){const{selectedItem:e,serverError:t}=this.state;let s;(null==e?void 0:e.failure)&&(s=j.substringBefore(null==e?void 0:e.failure,"at"),s.length>100&&(s=s.substring(0,100)+"..."));const o="**Markdown** is supported. Words [within brackets] or ALL_CAPS are converted like this";return(0,n.jsxs)(x,Object.assign({size:"50%",split:"vertical"},{children:[(0,n.jsxs)("div",Object.assign({className:"w100"},{children:[t&&(0,n.jsxs)(v.Z,Object.assign({open:!0},{children:[(0,n.jsx)(v.Z.Header,{children:"Error"},void 0),(0,n.jsx)(v.Z.Content,{children:t},void 0),(0,n.jsx)(v.Z.Actions,{children:(0,n.jsx)(a.Z,{positive:!0,content:"OK",onClick:()=>this.setState({serverError:void 0})},void 0)},void 0)]}),void 0),(0,n.jsx)(a.Z,{icon:"play",content:"Run current",disabled:!this.state.currentClassName,onClick:()=>this.runCurrent()},void 0),(0,n.jsx)(a.Z,{icon:"delete",content:"Clear current",disabled:!this.state.currentClassName,onClick:()=>this.setCurrent()},void 0),(0,n.jsx)(d.Z,{trigger:(0,n.jsx)(Ve.Z,{size:"big",color:"blue",name:"question circle"},void 0),wide:!0,content:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(dt.Z,Object.assign({dividing:!0},{children:"Legend"}),void 0),(0,n.jsx)(jt,{},void 0)," Class",(0,n.jsx)("p",{},void 0),(0,n.jsx)(bt,{},void 0)," Method",(0,n.jsx)("p",{},void 0),(0,n.jsx)(wt,{},void 0)," Has report",(0,n.jsx)("p",{},void 0),(0,n.jsx)(Tt,{},void 0)," Has error",(0,n.jsx)(m.Z,{},void 0),o,":",(0,n.jsx)("br",{},void 0)," ",(0,n.jsx)(N,{children:o},void 0)]},void 0)},void 0),(0,n.jsx)(m.Z,{},void 0),"Current: \xa0",this.state.currentClassName?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(jt,{},void 0)," ",this.state.currentClassName,(0,n.jsx)(bt,{},void 0)," ",this.state.currentMethodName,(0,n.jsx)(m.Z,{},void 0),(0,n.jsx)(gt,{linearizedItems:this.state.linearizedItemsCurrent,selectedIndexOnce:this.state.currentSelectedIndexAfterRun,onSelect:e=>this.setState({selectedItem:e})},void 0)]},void 0):"none",(0,n.jsx)(m.Z,{},void 0),(0,n.jsx)(gt,{linearizedItems:this.state.linearizedItems,onSelect:e=>this.setState({selectedItem:e}),onSetCurrent:e=>{"CLASS"===e.kind?this.setCurrent(e.name):this.setCurrent(e.parent.name,e.name)}},void 0)]}),void 0),(0,n.jsx)(ht.Z,{children:(0,n.jsx)(ut.Z,{panes:[{menuItem:"Markdown",render:()=>(0,n.jsx)(ut.Z.Pane,{children:(null==e?void 0:e.reportAsMarkdown)&&(0,n.jsx)(N,{children:null==e?void 0:e.reportAsMarkdown},void 0)},void 0)},{menuItem:"Initial, w/ custom renderers",render:()=>{var t;return(0,n.jsxs)(ut.Z.Pane,{children:[(null==e?void 0:e.failure)&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(dt.Z,Object.assign({as:"h2",color:"red",dividing:!0},{children:[(0,n.jsx)(Ve.Z,{name:"warning circle"},void 0),(0,n.jsxs)(dt.Z.Content,{children:["Error",(0,n.jsx)(dt.Z.Subheader,{children:s},void 0)]},void 0)]}),void 0),(0,n.jsx)("pre",{children:e.failure},void 0),(0,n.jsx)(m.Z,{},void 0)]},void 0),(null==e?void 0:e.description)&&(0,n.jsxs)(dt.Z,Object.assign({as:"h2",dividing:!0},{children:[(0,n.jsx)(Ve.Z,{name:"film"},void 0),(0,n.jsxs)(dt.Z.Content,{children:[null==e?void 0:e.name,(0,n.jsx)(dt.Z.Subheader,{children:(0,n.jsx)(N,{children:null==e?void 0:e.description},void 0)},void 0)]},void 0)]}),void 0),null===(t=null==e?void 0:e.report)||void 0===t?void 0:t.elements.map(((e,t)=>{const s=St[e.type];return(0,n.jsx)(i.Fragment,{children:s?(0,n.jsx)(s,{element:e},void 0):(0,n.jsxs)("p",{children:["Unknown element type: ",e.type]},void 0)},t)}))]},void 0)}}]},void 0)},void 0)]}),void 0)}}const jt=()=>(0,n.jsx)(h.Z,{circular:!0,color:"green",content:"C"},void 0),bt=()=>(0,n.jsx)(h.Z,{circular:!0,color:"yellow",content:"M"},void 0),wt=()=>(0,n.jsx)(h.Z,{circular:!0,color:"orange",content:"R"},void 0),Tt=()=>(0,n.jsx)(h.Z,{circular:!0,color:"red",content:"E"},void 0),St={ReportElementHeading:e=>{let{element:t}=e;return(0,n.jsx)(dt.Z,{children:(0,n.jsx)(N,{children:t.text},void 0)},void 0)},ReportElementParagraph:e=>{let{element:t}=e;return(0,n.jsx)("p",{children:(0,n.jsx)(N,{children:t.text},void 0)},void 0)},ReportElementCode:e=>{let{element:t}=e;return(0,n.jsx)(C.Z,Object.assign({language:t.language},{children:t.text}),void 0)},ReportElementTable:e=>{let{element:t}=e;var s;return(0,n.jsxs)(pt.Z,Object.assign({celled:!0},{children:[(0,n.jsx)(pt.Z.Header,{children:(0,n.jsx)(pt.Z.Row,{children:null===(s=t.rows[0])||void 0===s?void 0:s.cells.map(((e,t)=>(0,n.jsx)(pt.Z.HeaderCell,{children:e.text},t)))},void 0)},void 0),(0,n.jsx)(pt.Z.Body,{children:t.rows.map(((e,t)=>0===t?null:(0,n.jsx)(pt.Z.Row,{children:e.cells.map(((e,t)=>{let s;return null!==e.color&&void 0!==e.color&&(s={backgroundColor:j.convertColorToHex(e.color),color:j.convertColorToHex(j.getContrastingForegroundColor(e.color))}),(0,n.jsxs)(pt.Z.Cell,Object.assign({style:s},{children:[e.comment&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("small",{children:(0,n.jsx)("i",{children:(0,n.jsx)(N,{children:e.comment},void 0)},void 0)},void 0),(0,n.jsx)("br",{},void 0)]},void 0),(0,n.jsx)(N,{children:e.text},void 0)]}),t)}))},t)))},void 0)]}),void 0)}};function yt(e){const t={};for(let s in e.table){const n=e.table[s];for(let e in n)t[e]=!0}return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)(pt.Z,Object.assign({celled:!0,color:e.highlighted&&"yellow"},{children:[(0,n.jsx)(pt.Z.Header,{children:(0,n.jsx)(pt.Z.Row,{children:Object.getOwnPropertyNames(t).map((e=>(0,n.jsx)(pt.Z.HeaderCell,{children:e},e)))},void 0)},void 0),(0,n.jsx)(pt.Z.Body,{children:Object.getOwnPropertyNames(e.table).map((s=>(0,n.jsx)(pt.Z.Row,{children:Object.getOwnPropertyNames(t).map(((t,i)=>{var o,r,a;return(0,n.jsx)(pt.Z.Cell,Object.assign({className:(null===(o=e.highlighted)||void 0===o?void 0:o.id)==s&&(null===(r=e.highlighted)||void 0===r?void 0:r.field)===t?"MiniDbTableSetComponent_highlightedCell":""},{children:(null===(a=e.highlighted)||void 0===a?void 0:a.id)==s&&0===i?(0,n.jsx)(h.Z,Object.assign({ribbon:!0,color:"yellow"},{children:String(e.table[s][t])}),void 0):String(e.table[s][t])}),t)}))},s)))},void 0)]}),void 0)},void 0)}class Ct extends i.Component{render(){var e;const t=null===(e=window.testsAreDemoMaster.slave.getTestsAreDemoFunctions())||void 0===e?void 0:e.miniDb;return t?(0,n.jsx)(n.Fragment,{children:Object.getOwnPropertyNames(t.data).sort().map((e=>{var s,i;return(0,n.jsxs)("div",{children:[(0,n.jsx)(h.Z,{color:(null===(s=t.highlighted)||void 0===s?void 0:s.entityName)===e?"yellow":"teal",content:e},void 0),(0,n.jsx)(yt,{table:t.data[e],highlighted:(null===(i=t.highlighted)||void 0===i?void 0:i.entityName)===e?t.highlighted:void 0},e)]},e)}))},void 0):null}}var Et=function(e,t,s,n){return new(s||(s=Promise))((function(i,o){function r(e){try{l(n.next(e))}catch(t){o(t)}}function a(e){try{l(n.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,a)}l((n=n.apply(e,t||[])).next())}))};const{MESSAGE_FOR_PUPPETEER:Nt}=Pe;class It{constructor(){this.idOfLastMessage=0,this.idSent=-1}sendMessageToPuppeteer(e,t){return Et(this,void 0,void 0,(function*(){if(-1!==this.idSent)throw new Error(`A call to puppeteer is already in progress w/ id = ${this.idSent}. Somebody tries to send a new message w/ type = ${e} and content = ${JSON.stringify(t,void 0,2)}`);return this.idOfLastMessage++,this.idSent=this.idOfLastMessage,console.log(`${Nt} ${e} ${JSON.stringify(t)}`),setTimeout((()=>this.onPuppeteerFinished(this.idSent)),200),new Promise((e=>this.resolve=e))}))}onPuppeteerFinished(e){if(e!==this.idSent)throw new Error(`Received a message from puppeteer w/ id = ${e}, but the last message sent to puppeteer had id = ${this.idSent}`);this.idSent=-1,this.resolve&&(this.resolve(),this.resolve=void 0)}}var Dt=function(e,t,s,n){return new(s||(s=Promise))((function(i,o){function r(e){try{l(n.next(e))}catch(t){o(t)}}function a(e){try{l(n.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,a)}l((n=n.apply(e,t||[])).next())}))};class At extends i.Component{constructor(){super(...arguments),this.state={captureEnabled:!0}}onCapture(e,t){return Dt(this,void 0,void 0,(function*(){if(!this.state.captureEnabled)return!0;const s=yield new Promise((s=>{this.props.master.slave.setState({inspectedElement:e,inspectedElementPopup:this.renderQuestion(t,s)})}));if(this.props.master.slave.setState({inspectedElement:void 0,inspectedElementPopup:void 0}),s){const e=this.props.capturedUiApiCalls?this.props.capturedUiApiCalls+"\n":"";this.props.master.setState({capturedUiApiCalls:e+t})}return s}))}renderQuestion(e,t){return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Oe,Object.assign({className:"",showLineNumbers:!1},{children:e}),void 0),(0,n.jsx)(a.Z,{positive:!0,content:"Continue",onClick:()=>t(!0)},void 0),(0,n.jsx)(a.Z,{negative:!0,content:"Cancel",onClick:()=>t(!1)},void 0)]},void 0)}render(){const e=this.props.capturedUiApiCalls||'/**\n* "Capture UiApi events" is enabled when this tab is opened \n* and "Capture enabled" == true\n*\n* 1/ Perform some actions in the UI\n* 2/ Captured events will appear here\n* 3/ Copy/paste in your project/TAD file(s)\n*/';return(0,n.jsx)(n.Fragment,{children:this.props.master.state.running?(0,n.jsx)(n.Fragment,{children:"This UI is disabled because a test is running. "},void 0):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{children:[(0,n.jsx)(a.Z,{labelPosition:"left",content:"Capture enabled",onClick:()=>this.setState({captureEnabled:!this.state.captureEnabled}),icon:"square outline"+(this.state.captureEnabled?" check":""),color:this.state.captureEnabled?"green":void 0},void 0),(0,n.jsx)(a.Z,{icon:"erase",content:"Clear",onClick:()=>{this.props.master.setState({capturedUiApiCalls:void 0})}},void 0)]},void 0),(0,n.jsx)(Oe,{children:e},void 0)]},void 0)},void 0)}}var Ot=s(47471),kt=s(95627),Ft=s(13250),Pt=s(85554),Rt=function(e,t,s,n){return new(s||(s=Promise))((function(i,o){function r(e){try{l(n.next(e))}catch(t){o(t)}}function a(e){try{l(n.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,a)}l((n=n.apply(e,t||[])).next())}))};const{RECORDED_TESTS_INDEX:Mt}=Pe;class Zt extends ct{constructor(e){let t;super(e);let s=!0;e.showLeftPane?(t=new URLSearchParams(window.location.search).get(ds),t||(t=localStorage.getItem(as)||e.recordedTestsUrl,s=!1)):(t=e.recordedTestsUrl,s=!1);const n=localStorage.getItem(ls),i=n?JSON.parse(n):[];this.state={recordedTestsUrl:t,recordedTestsUrlEditing:t,recent:i},this.recordedTestsUrlChanged(t,s,t!==e.recordedTestsUrl)}recordedTestsUrlChanged(e,t,s){var n;return Rt(this,void 0,void 0,(function*(){let i;const o=null===(n=this.props.includeCredentialsInJsonRequestRegex)||void 0===n?void 0:n.test(e);try{const t=j.substringBefore(e,"/",!0);i=yield et(t+"/testClassDescriptors.json",o)}catch(r){}if(this.setState({recordedTestClassDescriptors:i,recordedTestsUrl:e,recordedTestsUrlEditing:e,includeCredentialsInJsonRequest:o}),t&&localStorage.setItem(as,e),s){const{recent:t}=this.state,s=t.indexOf(e);let n;s<0?(n=t.slice(0,9),n.splice(0,0,e)):(n=[...t],n[0]=t[s],n[s]=t[0]),this.setState({recent:n}),localStorage.setItem(ls,JSON.stringify(n))}if(this.props.selectedTestClass&&i)for(let e of i)if(e.name===this.props.selectedTestClass){this.setState({selectedDescriptor:e});break}}))}componentDidUpdate(e){}getShowLeftPane(){return this.props.showLeftPane}getTestClassDescriptors(){return this.state.recordedTestClassDescriptors}getAdditionalPropsForFeatureList(){return{localStorageKey:rs,selectedImposed:this.props.selectedTestClass}}getAdditionalPropsForTestClassComponent(){return{recordedTestsUrl:this.state.recordedTestsUrl,includeCredentialsInJsonRequest:this.state.includeCredentialsInJsonRequest}}render(){return(0,n.jsxs)("div",Object.assign({className:"FeaturebookUiRecorded"},{children:[this.getShowLeftPane()&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",Object.assign({className:"FeaturebookUiRecorded_bar"},{children:[(0,n.jsxs)("span",{children:[(0,n.jsxs)("b",{children:["URL for ",(0,n.jsx)("code",{children:Mt},void 0),":"]},void 0),"\xa0",(0,n.jsx)("br",{},void 0),(0,n.jsx)("a",Object.assign({href:Qe(ds,this.state.recordedTestsUrl),target:"_blank"},{children:"(shareable link)"}),void 0)]},void 0),(0,n.jsx)(mt.Z,{value:this.state.recordedTestsUrlEditing,onChange:(e,t)=>this.setState({recordedTestsUrlEditing:t.value})},void 0),"\xa0",this.state.recordedTestsUrlEditing!==this.state.recordedTestsUrl&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(h.Z,Object.assign({color:"brown",basic:!0},{children:"Editing ..."}),void 0),(0,n.jsxs)(Ot.Z,{children:[(0,n.jsx)(a.Z,{positive:!0,content:"Apply",onClick:e=>this.recordedTestsUrlChanged(this.state.recordedTestsUrlEditing,!0,!0)},void 0),(0,n.jsx)(kt.Z,{},void 0),(0,n.jsx)(a.Z,{negative:!0,content:"Cancel",onClick:e=>this.setState({recordedTestsUrlEditing:this.state.recordedTestsUrl})},void 0)]},void 0),"\xa0"]},void 0),(0,n.jsx)(a.Z,{content:"Default",onClick:e=>this.recordedTestsUrlChanged(this.props.recordedTestsUrl,!0,!1)},void 0),(0,n.jsx)(c.Z,Object.assign({text:"Recent",icon:"history",floating:!0,labeled:!0,button:!0,className:"icon",direction:"left"},{children:(0,n.jsx)(Ft.Z,{children:this.state.recent.map(((e,t)=>(0,n.jsx)(Pt.Z,{icon:"history",text:e,onClick:t=>this.recordedTestsUrlChanged(e,!0,!0)},t)))},void 0)}),void 0)]}),void 0),(0,n.jsx)(m.Z,{},void 0)]},void 0),super.render()]}),void 0)}}var _t=function(e,t,s,n){return new(s||(s=Promise))((function(i,o){function r(e){try{l(n.next(e))}catch(t){o(t)}}function a(e){try{l(n.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,a)}l((n=n.apply(e,t||[])).next())}))};const{MESSAGE_FOR_PUPPETEER:Ut,RECORDED_TESTS_DIR:Lt,RECORDED_TESTS_INDEX:Bt}=Pe;var Wt,$t,Ht;!function(e){e[e.OFF=0]="OFF",e[e.ON=1]="ON",e[e.CONTROLLED_BY_PROGRAM=2]="CONTROLLED_BY_PROGRAM"}(Wt||(Wt={})),function(e){e[e.TAD=0]="TAD",e[e.FB=1]="FB",e[e.FB_RECORDED=2]="FB_RECORDED",e[e.FB_SERVER=3]="FB_SERVER",e[e.DOC=4]="DOC",e[e.SCREENSHOTS=5]="SCREENSHOTS"}($t||($t={})),function(e){e[e.SRC=0]="SRC",e[e.TREE=1]="TREE",e[e.INSPECT=2]="INSPECT",e[e.MINI_DB=3]="MINI_DB",e[e.CAPTURE_UI_API_EVENTS=4]="CAPTURE_UI_API_EVENTS"}(Ht||(Ht={}));const zt="testsAreDemo.stepByStep",Vt="testsAreDemo.autoRun",qt="testsAreDemo.autoPressNext",Jt="testsAreDemo.endUser",Gt="testsAreDemo.horizontalLayout",Kt="testsAreDemo.size1",Yt="testsAreDemo.size2",Xt="testsAreDemo.menuState",Qt="testsAreDemo.tabState",es="testsAreDemo.currentClassName",ts="testsAreDemo.currentMethodName",ss="testsAreDemo.currentDoc",ns="testsAreDemo.currentDirWithScreenshots",is="testsAreDemo.testsToRun",os="testsAreDemo.currentTestClass",rs="testsAreDemo.currentTestClassRecorded",as="testsAreDemo.recordedTestsUrl",ls="testsAreDemo.recordedTestsUrlRecent",cs="testsToRun",ds="recordedTestsUrl",hs=Te("TestsAreDemoMaster",{nextStep:"",run:""});class us extends i.Component{constructor(){super(...arguments),this.state={menuState:$t.FB,tabState:Ht.SRC,sidebar:!1,running:!1,loggedMessages:"",horizontalLayout:!1,autoPressNextEnabled:!1,stepByStepMode:Wt.OFF,endUser:!1},this.testIdProp="data-testid",this.refMiniDbTableSetComponent=i.createRef(),this.refCaptureUiApiEvents=i.createRef(),this.puppeteerBridge=new It,this.onAutoPressTimerTick=()=>{this.state.autoPressNextAt&&j.now().getTime()>this.state.autoPressNextAt?(this.disableAutoPressTimerIfEnabled(!1),this.nextStep()):(this.setState({autoPressTimerId:setTimeout(this.onAutoPressTimerTick,1e3)}),this.forceUpdate())},this.onModifTabState=e=>{this.setState({tabState:e}),localStorage.setItem(Qt,""+e)},this.onStepByStepModeChanged=(e,t)=>{let{value:s}=t;const n=s;this.slave.stepByStep=n===Wt.ON,localStorage.setItem(zt,""+n),this.setState({stepByStepMode:n})},this.onModifSize1=e=>{this.setState({size1:e}),localStorage.setItem(Kt,""+e)},this.onModifSize2=e=>{this.setState({size2:e}),localStorage.setItem(Yt,""+e)},this.resetSizes=()=>{localStorage.removeItem(Kt),localStorage.removeItem(Yt),this.setState({size1:void 0,size2:void 0})},this.onModifMenuState=e=>{this.setState({menuState:e}),localStorage.setItem(Xt,""+e)}}get slave(){if(!this._slave)throw new Error("TestsAreDemoSlave (which should normally sit in the IFrame) did not connect to TestsAreDemoMaster");return this._slave}set slave(e){this._slave=e,this.readStepByStep(),this.forceUpdate(),this.getAutoRun()&&setTimeout((()=>this.run()))}onMochaReporterCreated(e,t,s){return new ye(this,e,t,s)}componentDidMount(){if(window.testsAreDemoMaster)throw new Error("Cannot create more than one instances of TestsAreDemoMaster");window.testsAreDemoMaster=this,"true"===localStorage.getItem(Gt)&&this.setState({horizontalLayout:!0});const e=parseInt(localStorage.getItem(Kt)||"");isNaN(e)||this.setState({size1:e});const t=parseInt(localStorage.getItem(Yt)||"");isNaN(t)||this.setState({size2:t});const s=parseInt(localStorage.getItem(Xt)||"");isNaN(s)||this.setState({menuState:s});const n=parseInt(localStorage.getItem(Qt)||"");isNaN(n)||this.setState({tabState:n}),this.props.puppeteer||("true"===localStorage.getItem(qt)&&this.setState({autoPressNextEnabled:!0}),"true"===localStorage.getItem(Jt)&&this.setState({endUser:!0}));const i=new URLSearchParams(window.location.search).get(cs)||!this.props.puppeteer&&localStorage.getItem(is);i&&this.setState({testsToRun:JSON.parse(i)})}readStepByStep(){let e;const t=localStorage.getItem(zt);e=this.props.forceStepByStep?Wt.ON:this.props.puppeteer?Wt.OFF:null===t||isNaN(Number(t))?Wt.ON:Number(t),this.slave.stepByStep=e===Wt.ON,this.setState({stepByStepMode:e})}getAutoRun(){return!!this.props.puppeteer||"false"!==localStorage.getItem(Vt)}updateTestsToRun(e){this.setState({testsToRun:e}),localStorage.setItem(is,JSON.stringify(e))}log(e){this.setState({loggedMessages:this.state.loggedMessages+"\n"+e})}sendMessageToPuppeteer(e,t){console.log(`${Ut} ${e} ${JSON.stringify(t)}`)}run(e){if(void 0===e&&(e=!1),this.state.menuState!==$t.TAD)if(e)this.onModifMenuState($t.TAD);else if(!this.props.puppeteer)return;this.setState({running:!0,loggedMessages:""}),this.slave.run()}nextStep(){this.disableAutoPressTimerIfEnabled(),this.slave.hideSpotlight(),this.state.finishWaitingCallback(),this.setState({finishWaitingCallback:void 0}),this.slave.report.messageSentToPuppeteer=void 0}enableNextStepButton(e){this.setState({finishWaitingCallback:e}),this.state.autoPressNextEnabled&&this.enableAutoPressTimer()}disableAutoPressTimerIfEnabled(e){void 0===e&&(e=!0),e&&clearTimeout(this.state.autoPressTimerId),this.setState({autoPressNextAt:void 0,autoPressTimerId:void 0})}enableAutoPressTimer(){this.setState({autoPressNextAt:j.now().getTime()+3e3}),this.onAutoPressTimerTick()}getIFrameUrl(e,t,s){return e+t+"?"+s.toString()}renderIFramePane(){const e=new URLSearchParams(window.location.search);return e.delete("TestsAreDemo"),e.append("testsAreDemoSlave",""),(0,n.jsx)("div",Object.assign({className:"flex-container flex-grow"},{children:(0,n.jsx)("iframe",{width:"100%",height:"100%",src:this.getIFrameUrl(window.location.origin,window.location.pathname,e)},void 0)}),void 0)}renderTabs(){const{tabState:e}=this.state;return(0,n.jsxs)("div",Object.assign({className:"flex-container flex-grow"},{children:[(0,n.jsxs)(o.Z,Object.assign({attached:"top",tabular:!0},{children:[(0,n.jsx)(o.Z.Item,Object.assign({active:Ht.SRC===e,onClick:()=>this.onModifTabState(Ht.SRC)},{children:"Source"}),void 0),(0,n.jsx)(o.Z.Item,Object.assign({active:Ht.TREE===e,onClick:()=>this.onModifTabState(Ht.TREE)},{children:"Tree"}),void 0),(0,n.jsx)(o.Z.Item,Object.assign({active:Ht.INSPECT===e,onClick:()=>this.onModifTabState(Ht.INSPECT)},{children:"Inspect testid"}),void 0),(0,n.jsx)(o.Z.Item,Object.assign({active:Ht.MINI_DB===e,onClick:()=>this.onModifTabState(Ht.MINI_DB)},{children:"Mini DB"}),void 0),(0,n.jsx)(o.Z.Item,Object.assign({active:Ht.CAPTURE_UI_API_EVENTS===e,onClick:()=>this.onModifTabState(Ht.CAPTURE_UI_API_EVENTS)},{children:"Capture UiApi events"}),void 0)]}),void 0),(0,n.jsxs)(r.Z,Object.assign({attached:"bottom",className:"flex-grow flex-container "+(Ht.SRC===e?"no-padding-margin ":"")},{children:[Ht.SRC===e&&(0,n.jsx)(Ae,{sourceCodeInfo:this.state.sourceCodeInfo},void 0),Ht.TREE===e&&(0,n.jsx)("textarea",{readOnly:!0,wrap:"off",style:{width:"100%",height:"100%"},value:this.state.loggedMessages},void 0),Ht.INSPECT===e&&(0,n.jsxs)("div",{children:[(0,n.jsx)(a.Z,{icon:"search",color:this.state.inspecting?"brown":void 0,content:"Inspect testid",onClick:()=>this.slave.toggleInspect()},void 0),this.state.inspecting&&!this.state.inspectedElements&&(0,n.jsx)(l.Z,Object.assign({color:"brown"},{children:(0,n.jsx)(N,{children:`\nNo element w/ \`${this.testIdProp}\` found under the mouse pointer.\nMove the mouse over various elements. If nothing found, did you add cf. below? E.g.:\n\n\`\`\`\n<Button ${this.testIdProp}={testids.edit} ... />\n\`\`\`\n\nClick anywhere to end the "inspect" mode".\n            `},void 0)}),void 0),this.state.inspectedElements&&(0,n.jsxs)(n.Fragment,{children:[this.state.justCopiedToClipboard?(0,n.jsx)(a.Z,{color:"green",icon:"check",content:"Copied to clipboard!"},void 0):(0,n.jsx)(c.Z,Object.assign({text:"Copy code snippet for ...",icon:"copy outline",floating:!0,labeled:!0,button:!0,className:"icon brown"},{children:(0,n.jsxs)(c.Z.Menu,{children:[(0,n.jsx)(d.Z,{trigger:(0,n.jsx)(c.Z.Item,{text:"Selector",onClick:()=>this.copySnippet(this.getSnippet())},void 0),position:"right center",content:this.renderSnippet(this.getSnippet())},void 0),(0,n.jsx)(d.Z,{trigger:(0,n.jsx)(c.Z.Item,{text:"Selector + action",onClick:()=>this.copySnippet(this.getSnippet("action"))},void 0),position:"right center",content:this.renderSnippet(this.getSnippet("action"))},void 0),(0,n.jsx)(d.Z,{trigger:(0,n.jsx)(c.Z.Item,{text:"Selector + verification",onClick:()=>this.copySnippet(this.getSnippet("verification"))},void 0),position:"right center",content:this.renderSnippet(this.getSnippet("verification"))},void 0)]},void 0)}),void 0),(0,n.jsx)(a.Z,{color:"brown",content:"Clear",onClick:()=>this.setState({inspectedElements:void 0})},void 0),(0,n.jsxs)(l.Z,Object.assign({color:"brown"},{children:[(0,n.jsx)("code",{children:this.testIdProp},void 0),"s under mouse cursor (child > parent): ",(0,n.jsx)("br",{},void 0),this.state.inspectedElements.map(((e,t)=>(0,n.jsx)(h.Z,{color:"brown",content:e.getAttribute(this.testIdProp),onMouseEnter:()=>this.slave.setState({inspectedElement:e}),onMouseLeave:()=>this.slave.setState({inspectedElement:void 0})},t))),(0,n.jsx)("br",{},void 0),'Click anywhere to end "inspect" mode. Hover labels to focus.']}),void 0)]},void 0)]},void 0),Ht.MINI_DB===e&&(0,n.jsx)(Ct,{ref:this.refMiniDbTableSetComponent},void 0),Ht.CAPTURE_UI_API_EVENTS===e&&(0,n.jsx)(At,{ref:this.refCaptureUiApiEvents,master:this,capturedUiApiCalls:this.state.capturedUiApiCalls},void 0)]}),void 0)]}),void 0)}getTestIdExpression(e){let t=j.substringAfter(e.getAttribute(this.testIdProp),"_");const s=t.split("_");return 1===s.length?t:`${s[0]} + "_${s[1]}"`}getSelectorExpression(e){let t="\t",s="";if(1===e.length)return{pre:t,result:`tad.screenCapturing.getByTestId(testids.${this.getTestIdExpression(e[0])})`};2===e.length?s="item":e.length>2&&(s="item1"),t+=`let ${s} = tad.screenCapturing.getByTestId(testids.${this.getTestIdExpression(e[e.length-1])});\n\t`;for(let n=e.length-2;n>=1;n--){const i=s;s="item"+(e.length-n),t+=`let ${s} = tad.withinCapturing(${i}).getByTestId(testids.${this.getTestIdExpression(e[n])});\n\t`}return{pre:t,result:`tad.withinCapturing(${s}).getByTestId(testids.${this.getTestIdExpression(e[0])})`}}getSnippet(e){const t=this.getSelectorExpression(this.state.inspectedElements);let s;return s="action"===e?`await tad.userEventWaitable.click(${t.result});`:"verification"===e?`await tad.assertWaitable.equal(${t.result}, "???");`:t.result+";",t.pre+s}renderSnippet(e){return(0,n.jsx)(N,{children:"```\n"+e+"\n```"},void 0)}copySnippet(e){return _t(this,void 0,void 0,(function*(){yield navigator.clipboard.writeText(e),this.setState({justCopiedToClipboard:!0}),yield j.setTimeoutPromise(void 0,1e3),this.setState({justCopiedToClipboard:!1})}))}renderControlPanel(){let e="";this.state.autoPressNextAt&&(e=" ("+Math.round((this.state.autoPressNextAt-j.now().getTime())/1e3)+")");const t=[{key:Wt.OFF,value:Wt.OFF,text:"OFF"},{key:Wt.ON,value:Wt.ON,text:"ON"},{key:Wt.CONTROLLED_BY_PROGRAM,value:Wt.CONTROLLED_BY_PROGRAM,text:"Controlled by program"}];return(0,n.jsxs)("div",{children:[(0,n.jsx)(u.Z,Object.assign({className:"TestsAreDemo_sidebar",as:r.Z,animation:"overlay",width:"very wide",visible:this.state.sidebar,onHide:()=>this.setState({sidebar:!1})},{children:(0,n.jsx)(p.Z,{children:(0,n.jsx)(p.Z.Row,Object.assign({columns:1},{children:(0,n.jsxs)(p.Z.Column,{children:[(0,n.jsx)(a.Z,{content:"Layout: "+(this.state.horizontalLayout?"horizontal":"vertical"),onClick:()=>{this.setState({horizontalLayout:!this.state.horizontalLayout}),this.resetSizes(),setTimeout((()=>localStorage.setItem(Gt,""+this.state.horizontalLayout)))}},void 0),(0,n.jsx)(a.Z,{icon:"redo",content:"Reset sizes",onClick:this.resetSizes},void 0),(0,n.jsx)(m.Z,{className:"TestsAreDemo_divider"},void 0),(0,n.jsx)(g.Z,{checked:this.state.autoPressNextEnabled,label:"Auto press 'Next step' with timer",onChange:()=>{this.state.autoPressNextEnabled?this.disableAutoPressTimerIfEnabled():this.enableAutoPressTimer(),localStorage.setItem(qt,""+!this.state.autoPressNextEnabled),this.setState({autoPressNextEnabled:!this.state.autoPressNextEnabled})}},void 0),(0,n.jsx)("br",{},void 0),(0,n.jsx)(g.Z,{checked:this.getAutoRun(),label:"Auto run after page load",onChange:()=>{localStorage.setItem(Vt,this.getAutoRun()?"false":"true"),this.forceUpdate()}},void 0),(0,n.jsx)("br",{},void 0),(0,n.jsx)(g.Z,{checked:this.state.endUser,label:"'Demo for end user' mode",onChange:()=>{localStorage.setItem(Jt,""+!this.state.endUser),this.setState({endUser:!this.state.endUser})}},void 0),(0,n.jsx)("br",{},void 0)]},void 0)}),void 0)},void 0)}),void 0),this.state.sidebar&&(0,n.jsx)(v.Z.Dimmer,{},void 0),(0,n.jsx)(a.Z,{icon:"bars",onClick:()=>this.setState({sidebar:!0})},void 0),(0,n.jsx)(c.Z,{className:"button icon",floating:!0,options:t,trigger:(0,n.jsxs)(n.Fragment,{children:["Step by step mode: ",t[this.state.stepByStepMode].text,"\xa0\xa0"]},void 0),value:this.state.stepByStepMode,onChange:this.onStepByStepModeChanged},void 0),(0,n.jsx)(a.Z,{"data-testid":hs.run,icon:"play",content:"Run: "+Ye(this.state.testsToRun),disabled:this.state.running,onClick:()=>this.run()},void 0),this.state.finishWaitingCallback&&(0,n.jsx)(a.Z,{"data-testid":hs.nextStep,icon:"step forward",content:"Next step"+e,onClick:()=>this.nextStep()},void 0),this.state.finishWaitingCallback&&(0,n.jsx)(a.Z,{icon:"forward",content:"Run normally",onClick:()=>{this.slave.stepByStep=!1,this.nextStep()}},void 0)]},void 0)}render(){if(this.props.puppeteer)return this.renderTad();const{menuState:e}=this.state;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(o.Z,Object.assign({style:{margin:"0"}},{children:[(0,n.jsx)(o.Z.Item,Object.assign({active:$t.FB===e,onClick:()=>this.onModifMenuState($t.FB)},{children:"Featurebook (client)"}),void 0),(0,n.jsx)(o.Z.Item,Object.assign({active:$t.TAD===e,onClick:()=>this.onModifMenuState($t.TAD)},{children:"Test run UI"}),void 0),(0,n.jsx)(o.Z.Item,Object.assign({active:$t.FB_RECORDED===e,onClick:()=>this.onModifMenuState($t.FB_RECORDED)},{children:"Featurebook (recorded tests)"}),void 0),(0,n.jsx)(o.Z.Item,Object.assign({active:$t.FB_SERVER===e,onClick:()=>this.onModifMenuState($t.FB_SERVER)},{children:"Featurebook (server)"}),void 0),(0,n.jsx)(o.Z.Item,Object.assign({active:$t.DOC===e,onClick:()=>this.onModifMenuState($t.DOC)},{children:"Doc from tests (deprecated)"}),void 0),(0,n.jsx)(o.Z.Item,Object.assign({active:$t.SCREENSHOTS===e,onClick:()=>this.onModifMenuState($t.SCREENSHOTS)},{children:"Screenshots from tests (deprecated)"}),void 0)]}),void 0),(0,n.jsxs)(r.Z,Object.assign({className:"TestsAreDemo_wrapperSegment",basic:!0},{children:[(0,n.jsx)("div",Object.assign({className:"TestsAreDemo_wrapperSegment",style:{display:$t.TAD===e?"flex":"none"}},{children:this.renderTad()}),void 0),$t.FB===e&&(0,n.jsx)(ct,{master:this,running:this.state.running,testClassDescriptors:this.state.testClassDescriptors,testsToRun:this.state.testsToRun},void 0),$t.FB_RECORDED===e&&(0,n.jsx)(Zt,{master:this,showLeftPane:!0,recordedTestsUrl:Lt+Bt},void 0),$t.FB_SERVER===e&&(0,n.jsx)(xt,{serverUrlPrefix:this.props.serverUrlPrefix},void 0),$t.DOC===e&&(0,n.jsx)(Ze,{},void 0),$t.SCREENSHOTS===e&&(0,n.jsx)(Be,{master:this},void 0)]}),void 0)]},void 0)}renderTad(){return this.props.puppeteer?this.renderIFramePane():this.state.horizontalLayout?(0,n.jsxs)(x,Object.assign({size:this.state.size1||"60%",split:"horizontal",onDragFinished:this.onModifSize1,onResizerDoubleClick:this.resetSizes},{children:[this.renderIFramePane(),this._slave?(0,n.jsxs)(x,Object.assign({split:"vertical",size:this.state.size2||"15%",onDragFinished:this.onModifSize2,onResizerDoubleClick:this.resetSizes},{children:[this.renderControlPanel(),this.renderTabs()]}),void 0):(0,n.jsx)("p",{children:"TestsAreDemoSlave not yet loaded"},void 0)]}),void 0):(0,n.jsxs)(x,Object.assign({size:this.state.size1||"30%",split:"vertical",onDragFinished:this.onModifSize1,onResizerDoubleClick:this.resetSizes},{children:[this._slave?(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",Object.assign({className:"flex-container wh100"},{children:[this.renderControlPanel(),(0,n.jsx)(m.Z,{className:"TestsAreDemo_divider"},void 0),this.renderTabs()]}),void 0)},void 0):(0,n.jsx)("p",{children:"TestsAreDemoSlave not yet loaded"},void 0),this.renderIFramePane()]}),void 0)}}var ps=function(e,t,s,n){return new(s||(s=Promise))((function(i,o){function r(e){try{l(n.next(e))}catch(t){o(t)}}function a(e){try{l(n.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,a)}l((n=n.apply(e,t||[])).next())}))};class ms extends i.Component{componentDidMount(){return ps(this,void 0,void 0,(function*(){if(ms.INSTANCE)throw new Error("Multiple instances of TestsAreDemoAppWrapper are not allowed.");ms.INSTANCE=this,this.props.importSemanticUiCss&&Promise.all([s.e(532),s.e(191)]).then(s.bind(s,1191))}))}render(){const e=this.props,t=new URLSearchParams(window.location.search);return t.has("TestsAreDemo")?(0,n.jsx)(us,{puppeteer:t.has("puppeteer"),forceStepByStep:t.has("forceStepByStep"),serverUrlPrefix:e.serverUrlPrefix},void 0):t.has("testsAreDemoSlave")?(0,n.jsx)(de,{importTestsCallback:e.importTestsCallback,createTestsAreDemoFunctions:e.createTestsAreDemoFunctions},void 0):e.app}}ms.defaultProps={importSemanticUiCss:!1,serverUrlPrefix:""};i.Component},41635:(e,t,s)=>{"use strict";s.d(t,{Z:()=>n});const n=s.p+"assets/images/anim-33b0f8dbbf4baf5127f85f483e40919f.gif"},60920:(e,t,s)=>{"use strict";s.d(t,{Z:()=>n});const n=s.p+"assets/images/del-click-d682acfbbc970ba43142ad1f03679b41.png"},91489:(e,t,s)=>{"use strict";s.d(t,{Z:()=>n});const n=s.p+"assets/images/inspect1-32edd4de97c7230dc4a1f62ae82abcbc.png"},36388:(e,t,s)=>{"use strict";s.d(t,{Z:()=>n});const n=s.p+"assets/images/inspect2-cc522bf72c254864b6599424562ef35d.png"},95757:(e,t,s)=>{"use strict";s.d(t,{Z:()=>n});const n=s.p+"assets/images/todos-16317d6bf7316ff60eb768bc8f67ee0e.png"},13810:(e,t,s)=>{"use strict";s.d(t,{Z:()=>n});const n=s.p+"assets/images/verify-not-deleted-8ed05663ea8ae42c3db53e158e5f3560.png"},63073:()=>{}}]);