var T=Object.defineProperty;var g=(o,e,t)=>e in o?T(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var u=(o,e,t)=>(g(o,typeof e!="symbol"?e+"":e,t),t);import{f as m,p as E,R as l,e as i,g as N,U as f,L as h,u as x,D as S,C as A,r as I}from"./index.e39bea13.js";function b(o){if(typeof o!="object")return!1;let e,t;do{if(t=Object.getPrototypeOf(o),e=Object.prototype.toString.call(t),e==="[object Element]"||e==="[object Document]")return!0;o=t}while(t!==null);return!1}function C(o){const{left:e,top:t,width:s,height:r}=o.getBoundingClientRect();return{x:e+s/2,y:t+r/2}}const W=o=>b(o)?C(o):o,P=o=>new Promise(e=>{setTimeout(e,o)});async function D(o,{to:e,delta:t,steps:s=20,duration:r=500}){const n=C(o),a=t?{x:n.x+t.x,y:n.y+t.y}:W(e),p={x:(a.x-n.x)/s,y:(a.y-n.y)/s},c={clientX:n.x,clientY:n.y};m.mouseEnter(o,c),m.mouseOver(o,c),m.mouseMove(o,c),m.mouseDown(o,c);for(let d=0;d<s;d++)c.clientX+=p.x,c.clientY+=p.y,await P(r/s),m.mouseMove(o,c);m.mouseUp(o,c)}const v=({children:o})=>l.createElement(l.Fragment,null,o);function O(o,e){const t=document.getElementById("rtl");return E.exports.render(o,{wrapper:v,container:t,...e})}const U=-1,F=/{s([0-9]+(?:\.[0-9]+)?)+}/;class B{constructor(e){u(this,"text");u(this,"lastSlideIndex",null);u(this,"nextSlideIndex",null);u(this,"master");var t;if(this.text=e,!((t=window.parent)!=null&&t.testsAreDemoMaster))throw new Error("Looking at the parent of this IFrame to find TestsAreDemoMaster. But was not found.");this.master=window.parent.testsAreDemoMaster}slide(e){if(!this.master.state.stepByStepMode)return;if(!this.nextSlideIndex){let n=this.text.match(F);if(!n)throw new Error("Could not find any slides.");this.nextSlideIndex=Number(n[1]).valueOf(),this.text=this.splitTextBySlidePattern(n)[1]}if(e!==this.nextSlideIndex)throw!this.text.match(`{s${e}`)&&e!==this.lastSlideIndex?new Error(`You are trying to access slide: ${e}, but it does not exist.`):new Error(`Last accesed slide: ${this.lastSlideIndex}. You should be now accesing slide: ${this.nextSlideIndex}. But you are accesing slide: ${e}.`);let t=this.text.match(F);if(!t){this.updateSlideProperties(this.text,this.nextSlideIndex,"",U);return}const s=Number(t[1]).valueOf();if(s<this.nextSlideIndex)throw new Error(`You are trying to access slide: ${e}. But we have found slide ${s} after slide ${e}. The slides should be in ascending order.`);let r=this.splitTextBySlidePattern(t);this.updateSlideProperties(r[0],this.nextSlideIndex,r[1],s)}splitTextBySlidePattern(e){const t=this.text.split(e[0]);if(t.length>2)throw new Error(`Slide ${e[1]} appears multiple times.`);return t}updateSlideProperties(e,t,s,r){i.INSTANCE.currentComment=e,i.INSTANCE.currentCommentSlideIndex=this.lastSlideIndex=t,this.text=s,this.nextSlideIndex=r}}class R{constructor(){u(this,"screenCapturing");u(this,"userEventWaitable");u(this,"drag");u(this,"assertWaitable");u(this,"waitForWhileException",E.exports.waitFor);u(this,"elementToObjectViaShortcutRefForTest",new Map);u(this,"slides");const e=this;this.createWrapperForDomSelectorFunction=this.createWrapperForDomSelectorFunction.bind(this),this.screenCapturing=this.iterateAndReplaceFunctions({...E.exports.screen},this.createWrapperForDomSelectorFunction),this.assertWaitable=this.iterateAndReplaceFunctions({...N},(t,s)=>async function(...r){let n=r[1];typeof n=="object"&&(n="Object ("+n.constructor.name+"): "+f.consoleLogJson(r[1],!1)),await e.showSpotlight({focusOnLastElementCaptured:!0,message:l.createElement(l.Fragment,null,l.createElement(h,{color:"green",content:"Testing"}),l.createElement(h,{content:t}),n&&l.createElement(h,{content:n}))}),s.apply(null,r)}),this.createWrapperForActionFunction=this.createWrapperForActionFunction.bind(this),this.userEventWaitable=this.iterateAndReplaceFunctions({...x},this.createWrapperForActionFunction),this.drag=this.createWrapperForActionFunction("drag",D)}iterateAndReplaceFunctions(e,t,s){for(const r in e){if(s&&!s(r))continue;const n=e[r],a=t(r,n);!a||(e[r]=a)}return e}createWrapperForActionFunction(e,t){const s=this;return function(...r){const n=typeof r[1]=="string"?" "+r[1]:"",a=s.showSpotlight({focusOnLastElementCaptured:!0,message:l.createElement(l.Fragment,null,l.createElement(h,{color:"blue",content:"Will perform action"}),l.createElement(h,{content:e}),n&&l.createElement(h,{content:n}))});if(!a)return t.apply(null,r);const p=new Promise(c=>{a.then(()=>{const d=t.apply(null,r);d instanceof Promise?d.then(y=>c(y)):c(a)})});return e!=="type"?p:new Promise(c=>p.then(d=>s.showSpotlight({focusOnLastElementCaptured:!0,message:"was typed"+n}).then(()=>c(d))))}}createWrapperForDomSelectorFunction(e,t){return e.startsWith("get")||e.startsWith("query")?function(...s){const r=t.apply(null,s);let n=r;return Array.isArray(r)&&(n=r[0]),i.INSTANCE.lastElementCaptured=n,r}:e.startsWith("find")?function(...s){const r=t.apply(null,s);return r.then(n=>{let a=n;return Array.isArray(n)&&(a=n[0]),i.INSTANCE.lastElementCaptured=a,a}),r}:null}withinCapturing(e,t){const s=E.exports.within(e,t);return this.iterateAndReplaceFunctions({...s},this.createWrapperForDomSelectorFunction)}showSpotlight(e){if(!!i.INSTANCE.stepByStep){if(i.INSTANCE.master.state.endUser){if(i.INSTANCE.demoForEndUser===S.HIDE)return;if(i.INSTANCE.demoForEndUser===S.HIDE_NEXT){this.demoForEndUserShow();return}}return typeof e=="string"&&(e={message:e}),e||(e={message:"",focusOnLastElementCaptured:!0}),new Promise(t=>i.INSTANCE.showSpotlight(e,t))}}async waitForWhile(e,t){t=t||{},t.interval=t.interval||50,t.timeout=t.timeout||2e3;const s=Date.now();for(;await e();)if(await f.setTimeoutPromise(()=>null,t.interval),Date.now()-s>t.timeout)throw new Error("Timeout after having waited "+t.timeout+"ms and having retried each "+t.interval+"ms")}async waitForCommunicationFinished(e){await f.setTimeoutPromise(void 0,300)}enableStepByStep(){i.INSTANCE.enableStepByStepProgrammatically()}getObjectViaShortcutRefForTestWaitable(e,t){const s=A.INSTANCE.getClassName(e)+(t?"_"+t:""),r=E.exports.getByTestId(document.body,s);i.INSTANCE.lastElementCaptured=r;let n=this.elementToObjectViaShortcutRefForTest.get(r);return n||(n=this.iterateAndReplaceFunctions(r.shortcutRefForTest,this.createWrapperForActionFunction,a=>a.startsWith("tad")),this.elementToObjectViaShortcutRefForTest.set(r,n)),n}wrapWithPropsSetter(e,t){let s={Component:()=>{const[r,n]=I.exports.useState(e);return s.setProps=n,l.createElement(l.Fragment,null,t(r))},setProps:null};return s}renderWrappedWithPropsSetter(e,t,s){const r=w.wrapWithPropsSetter(e,t);return{...O(l.createElement(r.Component,null),s),setProps:r.setProps}}currentComment(e){i.INSTANCE.currentComment=e,i.INSTANCE.currentCommentSlideIndex=void 0}cc(e){this.currentComment(e)}async loadSlides(e){const t=await fetch(e);this.slides=new B(await t.text())}currentSlide(e){if(!this.slides)throw new Error("Slides not loaded. Use 'loadSlides()'.");this.slides.slide(e)}cs(e){this.currentSlide(e)}demoForEndUserHide(){i.INSTANCE.demoForEndUser=S.HIDE,i.INSTANCE.demoForEndUserSavedCurrentCommentBeforeHide=i.INSTANCE.currentComment}demoForEndUserHideNext(){i.INSTANCE.demoForEndUser=S.HIDE_NEXT,i.INSTANCE.demoForEndUserSavedCurrentCommentBeforeHide=i.INSTANCE.currentComment}demoForEndUserShow(){i.INSTANCE.demoForEndUser=S.SHOW,i.INSTANCE.currentComment=i.INSTANCE.demoForEndUserSavedCurrentCommentBeforeHide,i.INSTANCE.demoForEndUserSavedCurrentCommentBeforeHide=null}}let w;function L(o){w=o}const M=Object.freeze(Object.defineProperty({__proto__:null,TestsAreDemoFunctions:R,get tad(){return w},setTad:L},Symbol.toStringTag,{value:"Module"}));export{M as T,O as c,w as t};
