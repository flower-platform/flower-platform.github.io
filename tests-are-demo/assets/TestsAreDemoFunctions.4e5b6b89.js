var R=Object.defineProperty;var U=(o,e,t)=>e in o?R(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var f=(o,e,t)=>(U(o,typeof e!="symbol"?e+"":e,t),t);import{f as E,p as F,R as d,d as a,e as $,U as A,L as w,u as B,D as g,C as j,r as L}from"./index.be008788.js";const I="$extensions for class$";let C,v;function x(o,e){C=o,v=e}function W(o){if(o||(o=C),!o)throw new Error("Error while calling 'pseudo' annotation. Not called via native decorators, and the global for 'pseudo' decorators is undefined.");let e=o.extensions;return e||(o.extensions=e={}),e}function b(o,e){const t=W(o);if(C&&(e=v),!e)throw new Error("Error while calling 'pseudo' annotation. The property should have a value.");let r=t[e];return r||(t[e]=r={}),r}function O(o){return C&&o.apply(null),o}function Q(o){return O(function(t,r){const n=b(t,r);n.scenario=o})}function Z(o){return O(function(t,r){const n=b(t,r);n.options=Object.assign(n.options||{},o)})}function ee(o){return O(function(t,r){t&&!r&&(r=I,t=t.prototype);const n=b(t,r);n.comments||(n.comments=[]),n.comments.splice(0,0,o)})}function M(o){if(typeof o!="object")return!1;let e,t;do{if(t=Object.getPrototypeOf(o),e=Object.prototype.toString.call(t),e==="[object Element]"||e==="[object Document]")return!0;o=t}while(t!==null);return!1}function D(o){const{left:e,top:t,width:r,height:n}=o.getBoundingClientRect();return{x:e+r/2,y:t+n/2}}const _=o=>M(o)?D(o):o,H=o=>new Promise(e=>{setTimeout(e,o)});async function X(o,{to:e,delta:t,steps:r=20,duration:n=500}){const s=D(o),c=t?{x:s.x+t.x,y:s.y+t.y}:_(e),h={x:(c.x-s.x)/r,y:(c.y-s.y)/r},l={clientX:s.x,clientY:s.y};E.mouseEnter(o,l),E.mouseOver(o,l),E.mouseMove(o,l),E.mouseDown(o,l);for(let m=0;m<r;m++)l.clientX+=h.x,l.clientY+=h.y,await H(n/r),E.mouseMove(o,l);E.mouseUp(o,l)}const k=({children:o})=>d.createElement(d.Fragment,null,o);function Y(o,e){const t=document.getElementById("rtl");return F.exports.render(o,{wrapper:k,container:t,...e})}const V=-1,P=/{s([0-9]+(?:\.[0-9]+)?)+}/;class G{constructor(e){f(this,"text");f(this,"lastSlideIndex",null);f(this,"nextSlideIndex",null);f(this,"master");var t;if(this.text=e,!((t=window.parent)!=null&&t.testsAreDemoMaster))throw new Error("Looking at the parent of this IFrame to find TestsAreDemoMaster. But was not found.");this.master=window.parent.testsAreDemoMaster}slide(e){if(!this.master.state.stepByStepMode)return;if(!this.nextSlideIndex){let s=this.text.match(P);if(!s)throw new Error("Could not find any slides.");this.nextSlideIndex=Number(s[1]).valueOf(),this.text=this.splitTextBySlidePattern(s)[1]}if(e!==this.nextSlideIndex)throw!this.text.match(`{s${e}`)&&e!==this.lastSlideIndex?new Error(`You are trying to access slide: ${e}, but it does not exist.`):new Error(`Last accesed slide: ${this.lastSlideIndex}. You should be now accesing slide: ${this.nextSlideIndex}. But you are accesing slide: ${e}.`);let t=this.text.match(P);if(!t){this.updateSlideProperties(this.text,this.nextSlideIndex,"",V);return}const r=Number(t[1]).valueOf();if(r<this.nextSlideIndex)throw new Error(`You are trying to access slide: ${e}. But we have found slide ${r} after slide ${e}. The slides should be in ascending order.`);let n=this.splitTextBySlidePattern(t);this.updateSlideProperties(n[0],this.nextSlideIndex,n[1],r)}splitTextBySlidePattern(e){const t=this.text.split(e[0]);if(t.length>2)throw new Error(`Slide ${e[1]} appears multiple times.`);return t}updateSlideProperties(e,t,r,n){a.INSTANCE.currentComment=e,a.INSTANCE.currentCommentSlideIndex=this.lastSlideIndex=t,this.text=r,this.nextSlideIndex=n}}class q{constructor(){f(this,"screenCapturing");f(this,"userEventWaitable");f(this,"drag");f(this,"assertWaitable");f(this,"waitForWhileException",F.exports.waitFor);f(this,"elementToObjectViaShortcutRefForTest",new Map);f(this,"slides");const e=this;this.createWrapperForDomSelectorFunction=this.createWrapperForDomSelectorFunction.bind(this),this.screenCapturing=this.iterateAndReplaceFunctions({...F.exports.screen},this.createWrapperForDomSelectorFunction),this.assertWaitable=this.iterateAndReplaceFunctions({...$},(t,r)=>async function(...n){let s=n[1];typeof s=="object"&&(s="Object ("+s.constructor.name+"): "+A.consoleLogJson(n[1],!1)),await e.showSpotlight({focusOnLastElementCaptured:!0,message:d.createElement(d.Fragment,null,d.createElement(w,{color:"green",content:"Testing"}),d.createElement(w,{content:t}),s&&d.createElement(w,{content:s}))}),r.apply(null,n)}),this.createWrapperForActionFunction=this.createWrapperForActionFunction.bind(this),this.userEventWaitable=this.iterateAndReplaceFunctions({...B},this.createWrapperForActionFunction),this.drag=this.createWrapperForActionFunction("drag",X)}iterateAndReplaceFunctions(e,t,r){for(const n in e){if(r&&!r(n))continue;const s=e[n],c=t(n,s);!c||(e[n]=c)}return e}createWrapperForActionFunction(e,t){const r=this;return function(...n){const s=typeof n[1]=="string"?" "+n[1]:"",c=r.showSpotlight({focusOnLastElementCaptured:!0,message:d.createElement(d.Fragment,null,d.createElement(w,{color:"blue",content:"Will perform action"}),d.createElement(w,{content:e}),s&&d.createElement(w,{content:s}))});if(!c)return t.apply(null,n);const h=new Promise(l=>{c.then(()=>{const m=t.apply(null,n);m instanceof Promise?m.then(p=>l(p)):l(c)})});return e!=="type"?h:new Promise(l=>h.then(m=>r.showSpotlight({focusOnLastElementCaptured:!0,message:"was typed"+s}).then(()=>l(m))))}}createWrapperForDomSelectorFunction(e,t){return e.startsWith("get")||e.startsWith("query")?function(...r){const n=t.apply(null,r);let s=n;return Array.isArray(n)&&(s=n[0]),a.INSTANCE.lastElementCaptured=s,n}:e.startsWith("find")?function(...r){const n=t.apply(null,r);return n.then(s=>{let c=s;return Array.isArray(s)&&(c=s[0]),a.INSTANCE.lastElementCaptured=c,c}),n}:null}withinCapturing(e,t){const r=F.exports.within(e,t);return this.iterateAndReplaceFunctions({...r},this.createWrapperForDomSelectorFunction)}showSpotlight(e){if(!!a.INSTANCE.stepByStep){if(a.INSTANCE.master.state.endUser){if(a.INSTANCE.demoForEndUser===g.HIDE)return;if(a.INSTANCE.demoForEndUser===g.HIDE_NEXT){this.demoForEndUserShow();return}}return typeof e=="string"&&(e={message:e}),e||(e={message:"",focusOnLastElementCaptured:!0}),new Promise(t=>a.INSTANCE.showSpotlight(e,t))}}async waitForWhile(e,t){t=t||{},t.interval=t.interval||50,t.timeout=t.timeout||2e3;const r=Date.now();for(;await e();)if(await A.setTimeoutPromise(()=>null,t.interval),Date.now()-r>t.timeout)throw new Error("Timeout after having waited "+t.timeout+"ms and having retried each "+t.interval+"ms")}async waitForCommunicationFinished(e){await A.setTimeoutPromise(void 0,300)}enableStepByStep(){a.INSTANCE.enableStepByStepProgrammatically()}getObjectViaShortcutRefForTestWaitable(e,t){const r=j.INSTANCE.getClassName(e)+(t?"_"+t:""),n=F.exports.getByTestId(document.body,r);a.INSTANCE.lastElementCaptured=n;let s=this.elementToObjectViaShortcutRefForTest.get(n);return s||(s=this.iterateAndReplaceFunctions(n.shortcutRefForTest,this.createWrapperForActionFunction,c=>c.startsWith("tad")),this.elementToObjectViaShortcutRefForTest.set(n,s)),s}wrapWithPropsSetter(e,t){let r={Component:()=>{const[n,s]=L.exports.useState(e);return r.setProps=s,d.createElement(d.Fragment,null,t(n))},setProps:null};return r}renderWrappedWithPropsSetter(e,t,r){const n=y.wrapWithPropsSetter(e,t);return{...Y(d.createElement(n.Component,null),r),setProps:n.setProps}}currentComment(e){a.INSTANCE.currentComment=e,a.INSTANCE.currentCommentSlideIndex=void 0}cc(e){this.currentComment(e)}async loadSlides(e){const t=await fetch(e);this.slides=new G(await t.text())}currentSlide(e){if(!this.slides)throw new Error("Slides not loaded. Use 'loadSlides()'.");this.slides.slide(e)}cs(e){this.currentSlide(e)}demoForEndUserHide(){a.INSTANCE.demoForEndUser=g.HIDE,a.INSTANCE.demoForEndUserSavedCurrentCommentBeforeHide=a.INSTANCE.currentComment}demoForEndUserHideNext(){a.INSTANCE.demoForEndUser=g.HIDE_NEXT,a.INSTANCE.demoForEndUserSavedCurrentCommentBeforeHide=a.INSTANCE.currentComment}demoForEndUserShow(){a.INSTANCE.demoForEndUser=g.SHOW,a.INSTANCE.currentComment=a.INSTANCE.demoForEndUserSavedCurrentCommentBeforeHide,a.INSTANCE.demoForEndUserSavedCurrentCommentBeforeHide=null}addTests(...e){const t=[];for(let r of e)this.addTest(r,t);window.parent.testsAreDemoMaster.setState({tests:t})}addTest(e,t){const r={name:e.name,functions:[]};t.push(r),describe(e.name,()=>{var p;const n=new e,s=Object.getPrototypeOf(n),c=W(s),h=Object.getOwnPropertyNames(s),l=this.getFunctionsThatNeedOnly(c,h);let m;for(let u=0;u<h.length;u++){const i=h[u];if(typeof n[i]!="function"||i==="constructor")continue;const N=n[i];if(i==="annotation"){x(s,I),N.apply(n);continue}else if(i.startsWith("annotation")){m=N;continue}const T=N.bind(n);if(i==="before")before(T);else{m&&(x(s,i),m.apply(n));const S=c[i];r.functions.push({functionName:i,scenario:S==null?void 0:S.scenario,comments:S==null?void 0:S.comments}),l[u]?it.only(i,T):it(i,T)}x(void 0,void 0)}r.comments=(p=c[I])==null?void 0:p.comments})}getFunctionsThatNeedOnly(e,t){var h,l,m,p;const r=new Array(t.length),n=new Array(t.length);let s=!1;for(let u=0;u<t.length;u++){const i=e==null?void 0:e[t[u]];(((h=i==null?void 0:i.options)==null?void 0:h.runOnlyThisScenario)||s)&&(r[u]=!0,s=(l=i==null?void 0:i.options)==null?void 0:l.linkWithNextScenario),u<t.length-1&&(n[u+1]=(m=i==null?void 0:i.options)==null?void 0:m.linkWithNextScenario)}let c=!1;for(let u=t.length-1;u>=0;u--){const i=e==null?void 0:e[t[u]];(((p=i==null?void 0:i.options)==null?void 0:p.runOnlyThisScenario)||c)&&(r[u]=!0,c=n[u])}return r}}let y;function z(o){if(window.testsAreDemoMaster){const e={get(t,r,n){throw new Error("Attempting to use 'tad' outside the slave IFrame (which runs the test). Please review the stack trace to understand who's doing this illegal call.")}};y=new Proxy({},e)}else y=o}const te=Object.freeze(Object.defineProperty({__proto__:null,TestsAreDemoFunctions:q,get tad(){return y},setTad:z},Symbol.toStringTag,{value:"Module"}));export{ee as C,Q as S,te as T,Z as a,Y as c,y as t};
