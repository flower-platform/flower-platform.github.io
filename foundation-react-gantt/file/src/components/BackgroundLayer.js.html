<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">src/components/BackgroundLayer.js | @crispico/react-timeline-10000</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<link rel="stylesheet" href="./inject/css/0-esdoc.css"><meta name="description" content="Performance focused timeline for react"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="@crispico/react-timeline-10000"><meta property="twitter:description" content="Performance focused timeline for react"></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/timeline.js~Timeline.html">Timeline</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components">components</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/BackgroundLayer.js~BackgroundLayer.html">BackgroundLayer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/ColumnRenderer.js~ColumnHeaderRenderer.html">ColumnHeaderRenderer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/GroupRenderer.js~GroupRenderer.html">GroupRenderer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/HighlightedInterval.js~HighlightedInterval.html">HighlightedInterval</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/ItemRenderer.js~ItemRenderer.html">ItemRenderer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/Marker.js~Marker.html">Marker</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/body.js~TimelineBody.html">TimelineBody</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/selector.js~SelectBox.html">SelectBox</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/timebar.js~Timebar.html">Timebar</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#consts">consts</a><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-timebarFormat">timebarFormat</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#stories">stories</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-encodeApiDocURIForSubpath">encodeApiDocURIForSubpath</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-parametersDocPage">parametersDocPage</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#stories-backgroundlayer">stories/backgroundLayer</a><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-backgroundLayerScenarios">backgroundLayerScenarios</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#utils">utils</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-intToPix">intToPix</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-pixToInt">pixToInt</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-sumStyle">sumStyle</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-adjustRowTopPositionToViewport">adjustRowTopPositionToViewport</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-findAncestorWithClassName">findAncestorWithClassName</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getMaxOverlappingItems">getMaxOverlappingItems</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getNearestRowNumber">getNearestRowNumber</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getNearestRowObject">getNearestRowObject</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getRowObjectRowNumber">getRowObjectRowNumber</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getTrueBottom">getTrueBottom</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getVerticalMarginBorder">getVerticalMarginBorder</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-rowLayerRenderer">rowLayerRenderer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-convertDateToMoment">convertDateToMoment</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-convertMomentToDateType">convertMomentToDateType</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getDurationFromPixels">getDurationFromPixels</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getPixelAtTime">getPixelAtTime</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getSnapPixelFromDelta">getSnapPixelFromDelta</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getTimeAtPixel">getTimeAtPixel</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-pixelsPerMillisecond">pixelsPerMillisecond</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-timeSnap">timeSnap</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-external">E</span><span data-ice="name"><span><a href="http://momentjs.com/">moment</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/components/BackgroundLayer.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import React, {Fragment} from &apos;react&apos;;
import PropTypes from &apos;prop-types&apos;;
import _ from &apos;lodash&apos;;
import {convertDateToMoment} from &apos;../utils/timeUtils&apos;;
import {Marker} from &apos;./Marker&apos;;
import {HighlightedInterval} from &apos;./HighlightedInterval&apos;;
import moment from &apos;moment&apos;;

/**
 * @extends React.Component&lt;BackgroundLayer.propTypes&gt;
 */
export class BackgroundLayer extends React.Component {
  static propTypes = {
    /**
     * If `true`, it highlights the weekends.
     *
     * @type { boolean }
     */
    highlightWeekends: PropTypes.bool,

    /**
     * Custom class name for highlighting the weekends.
     *
     * NOTE: No need to provide this; because it has a default class. If a custom class is provided, `!important` should be used to override properties from the default class.
     *
     * @type { string }
     */
    highlightWeekendsClassName: PropTypes.string,

    /**
     * Custom style for highlighting the weekends.
     *
     * NOTE: No need to provide this; because it has a default class.
     *
     * @type { object }
     */
    highlightWeekendsStyle: PropTypes.object,

    /**
     * If `true`, it draws a marker (vertical line) that indicates the current time.
     *
     * @type { boolean }
     */
    nowMarker: PropTypes.bool,

    /**
     * Custom class name for now marker.
     *
     * NOTE: No need to provide this; because it has a default class. If a custom class is provided, `!important` should be used to override properties from the default class.
     *
     * @type { string }
     */
    nowMarkerClassName: PropTypes.string,

    /**
     * Custom style for now marker.
     *
     * NOTE: No need to provide this; because it has a default class.
     *
     * @type { object }
     */
    nowMarkerStyle: PropTypes.object,

    /**
     * If `true`, it draws vertical lines, according to the intervals defined by the bottom `Timebar`.
     *
     * @type { boolean }
     */
    verticalGrid: PropTypes.bool,

    /**
     * Custom class name for vertical grid.
     *
     * NOTE: No need to provide this; because it has a default class. If a custom class is provided, `!important` should be used to override properties from the default class.
     *
     * @type { string }
     */
    verticalGridClassName: PropTypes.string,

    /**
     * Custom style for vertical grid.
     *
     * NOTE: No need to provide this; because it has a default class.
     *
     * @type { object }
     */
    verticalGridStyle: PropTypes.object,

    /**
     * @type { Array.&lt;JSX.Element&gt; }
     */
    markers: PropTypes.arrayOf(PropTypes.object),

    /**
     * @type { Array.&lt;JSX.Element&gt; }
     */
    highlightedIntervals: PropTypes.arrayOf(PropTypes.object),

    /**
     * Internal (passed by parent). Start of the timeline display interval, as date (moment object).
     *
     * @type { object }
     */
    startDateTimeline: PropTypes.object,

    /**
     * Internal (passed by parent). End of the timeline display interval, as date (moment object).
     *
     * @type { object }
     */
    endDateTimeline: PropTypes.object,

    /**
     * Internal (passed by parent). The height of the background layer.
     *
     * @type { number }
     */
    height: PropTypes.number,

    /**
     * Internal (passed by parent). The position of the top edge of background layer.
     *
     * @type { number }
     */
    topOffset: PropTypes.number,

    /**
     * Internal (passed by parent). Total width of the timeline.
     *
     * @type { number }
     */
    width: PropTypes.number,

    /**
     * Internal (passed by parent). The position of the left edge of background layer.
     *
     * @type { number }
     */
    leftOffset: PropTypes.number,

    /**
     * Internal (passed by parent). The vertical lines of the grid are already calculated by `Timerbar`.
     *
     * @type { Array.&lt;object&gt;}
     */
    verticalGridLines: PropTypes.arrayOf(PropTypes.object)
  };

  static defaultProps = {
    highlightWeekends: false,
    highlightWeekendsClassName: undefined,
    highlightWeekendsStyle: undefined,
    nowMarker: false,
    nowMarkerClassName: undefined,
    nowMarkerStyle: undefined,
    verticalGrid: false,
    verticalGridClassName: undefined,
    verticalGridStyle: undefined,
    verticalGridLines: [],
    markers: [],
    highlightedIntervals: [],
    height: undefined,
    topOffset: undefined,
    width: undefined,
    leftOffset: undefined,
    startDateTimeline: undefined,
    endDateTimeline: undefined
  };

  constructor(props) {
    super(props);
    this.state = {verticalLines: [], shouldUpdate: false, weekends: []};
    this.calculateHorizontalPosition = this.calculateHorizontalPosition.bind(this);
  }

  componentDidMount() {
    this.calculateHighlightedWeekends();
  }

  componentDidUpdate(prevProps) {
    if (
      this.props.height !== prevProps.height ||
      this.props.width !== prevProps.width ||
      !this.props.startDateTimeline.isSame(prevProps.startDateTimeline) ||
      !this.props.endDateTimeline.isSame(prevProps.endDateTimeline)
    ) {
      this.calculateHighlightedWeekends();
      this.setState({shouldUpdate: true});
      return;
    }
    if (this.state.shouldUpdate) {
      this.setState({shouldUpdate: false});
    }
  }

  /**
   * It calculates the horizontal position (left and width in pixels) of an element from the time positions (start, end).
   * @param { object | number } start
   * @param { object | number } end
   * @returns { object } left position and width in pixels
   */
  calculateHorizontalPosition(start, end) {
    const intervalMillis = this.props.endDateTimeline.diff(this.props.startDateTimeline, &apos;milliseconds&apos;);
    const pixelsPerMillis = (this.props.width - this.props.leftOffset) / intervalMillis;
    const startAsMoment = convertDateToMoment(start);
    const endAsMoment = convertDateToMoment(end);
    if (endAsMoment.isBefore(this.props.startDateTimeline) || startAsMoment.isAfter(this.props.endDateTimeline)) {
      return {};
    }

    let offset = startAsMoment.diff(this.props.startDateTimeline, &apos;milliseconds&apos;);
    let duration = endAsMoment.diff(startAsMoment, &apos;milliseconds&apos;);
    const left = this.props.leftOffset + offset * pixelsPerMillis;
    let width = Math.round(duration * pixelsPerMillis);
    return {left, width};
  }

  /**
   * Calculates the weekend intervals for the timeline displayed interval (`startDateTimeline` - `endDateTimeline`).
   */
  calculateHighlightedWeekends() {
    let weekends = [];
    if (!this.props.highlightWeekends) {
      return;
    }

    // get display interval start date; if it&apos;s sunday, substract a day
    let startDate = this.props.startDateTimeline.clone();
    if (startDate.weekday() == 0) {
      startDate = startDate.subtract(1, &apos;days&apos;);
    }

    let weekendStartDate = startDate.startOf(&apos;isoWeek&apos;).day(&apos;saturday&apos;);
    let weekendEndDate = null;
    // compute all the weekends in the interval
    while (weekendStartDate &lt; this.props.endDateTimeline) {
      weekendEndDate = weekendStartDate.clone().add(2, &apos;days&apos;);
      weekends.push({
        start: weekendStartDate,
        end: weekendEndDate,
        className: `rct9k-background-layer-highlight-weekends ${this.props.highlightWeekendsClassName}`
      });

      // go to the next weekend
      weekendStartDate = weekendEndDate
        .clone()
        .startOf(&apos;isoWeek&apos;)
        .day(&apos;saturday&apos;);
    }
    this.setState({weekends: weekends});
  }

  renderHighlightedWeekends() {
    return (
      &lt;Fragment&gt;
        {this.props.highlightWeekends &amp;&amp;
          this.state.weekends.map((weekend, index) =&gt; {
            return (
              &lt;HighlightedInterval
                key={index}
                start={weekend.start}
                end={weekend.end}
                className={weekend.className}
                style={this.props.highlightWeekendsStyle}
                top={this.props.topOffset}
                height={this.props.height}
                shouldUpdate={this.state.shouldUpdate}
                calculateHorizontalPosition={this.calculateHorizontalPosition}
              /&gt;
            );
          })}
      &lt;/Fragment&gt;
    );
  }

  renderCustomComponents(components) {
    return (
      &lt;Fragment&gt;
        {components.map((component, index) =&gt; {
          return React.cloneElement(component, {
            key: index,
            height: this.props.height,
            top: this.props.topOffset,
            shouldUpdate: this.state.shouldUpdate,
            calculateHorizontalPosition: this.calculateHorizontalPosition
          });
        })}
      &lt;/Fragment&gt;
    );
  }

  renderVerticalGrid() {
    const {verticalGrid, topOffset, height, leftOffset, width, verticalGridLines, verticalGridClassName} = this.props;
    return (
      &lt;Fragment&gt;
        {verticalGrid &amp;&amp; verticalGridLines &amp;&amp; (
          &lt;div
            className=&quot;rct9k-background-layer-vertical-grid&quot;
            style={{top: topOffset, height: height, left: leftOffset, width: width - leftOffset}}&gt;
            {verticalGridLines.map((verticalLine, index) =&gt; {
              return (
                &lt;span
                  key={index}
                  className={`rct9k-background-layer-vertical-line ${verticalGridClassName}`}
                  style={{...this.props.verticalGridStyle, width: verticalLine.size}}
                /&gt;
              );
            })}
          &lt;/div&gt;
        )}
      &lt;/Fragment&gt;
    );
  }

  renderNowMarker() {
    const {nowMarker, height, topOffset, nowMarkerClassName} = this.props;
    const currentDate = moment();
    const overlappsDisplayedInterval =
      this.props.startDateTimeline.isSameOrBefore(currentDate) &amp;&amp; this.props.endDateTimeline.isSameOrAfter(currentDate);
    return (
      &lt;Fragment&gt;
        {nowMarker &amp;&amp; overlappsDisplayedInterval &amp;&amp; (
          &lt;Marker
            date={currentDate}
            top={0}
            height={height + topOffset}
            shouldUpdate={this.state.shouldUpdate}
            calculateHorizontalPosition={this.calculateHorizontalPosition}
            className={`rct9k-background-layer-now-marker ${nowMarkerClassName}`}
            style={this.props.nowMarkerStyle}
          /&gt;
        )}
      &lt;/Fragment&gt;
    );
  }

  render() {
    return (
      &lt;Fragment&gt;
        {this.renderHighlightedWeekends()}
        {this.renderCustomComponents(this.props.highlightedIntervals)}
        {this.renderNowMarker()}
        {this.renderCustomComponents(this.props.markers)}
        {this.renderVerticalGrid()}
      &lt;/Fragment&gt;
    );
  }
}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
